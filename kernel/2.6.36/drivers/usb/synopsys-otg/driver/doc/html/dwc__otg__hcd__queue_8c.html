<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver: dwc_otg_hcd_queue.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>dwc_otg_hcd_queue.c File Reference</h1>This file contains the functions to manage Queue Heads and Queue Transfer Descriptors. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="dwc__otg__hcd_8h-source.html">dwc_otg_hcd.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="dwc__otg__regs_8h-source.html">dwc_otg_regs.h</a>&quot;</code><br>

<p>
<a href="dwc__otg__hcd__queue_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="e740bef95f7929a07065b699f6f087a2"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::BitStuffTime" ref="e740bef95f7929a07065b699f6f087a2" args="(bytecount)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#e740bef95f7929a07065b699f6f087a2">BitStuffTime</a>(bytecount)&nbsp;&nbsp;&nbsp;((8 * 7* bytecount) / 6)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="2a974c684e456c20cc2d9bceb2e71a11"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::HS_HOST_DELAY" ref="2a974c684e456c20cc2d9bceb2e71a11" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#2a974c684e456c20cc2d9bceb2e71a11">HS_HOST_DELAY</a>&nbsp;&nbsp;&nbsp;5</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="8f9875d35aace115a340d2cef9c66294"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::FS_LS_HOST_DELAY" ref="8f9875d35aace115a340d2cef9c66294" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#8f9875d35aace115a340d2cef9c66294">FS_LS_HOST_DELAY</a>&nbsp;&nbsp;&nbsp;1000</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d596163a6f24db7fb4ee092a933e03a2"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::HUB_LS_SETUP" ref="d596163a6f24db7fb4ee092a933e03a2" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#d596163a6f24db7fb4ee092a933e03a2">HUB_LS_SETUP</a>&nbsp;&nbsp;&nbsp;333</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="1df143acbaa5817cd09c8cca89851747"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::NS_TO_US" ref="1df143acbaa5817cd09c8cca89851747" args="(ns)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#1df143acbaa5817cd09c8cca89851747">NS_TO_US</a>(ns)&nbsp;&nbsp;&nbsp;((ns + 500) / 1000)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#86d31a59a5f7c095cd183a06edeed5e1">SCHEDULE_SLOP</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes a QH structure.  <a href="#86d31a59a5f7c095cd183a06edeed5e1"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#1ac731c0691ac3851edddc558fae79e0">dwc_otg_hcd_qh_free</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free each QTD in the QH's QTD-list then free the QH.  <a href="#1ac731c0691ac3851edddc558fae79e0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="49a9d4aa15e01fc07d68826bd05c0f4d"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::calc_bus_time" ref="49a9d4aa15e01fc07d68826bd05c0f4d" args="(int speed, int is_in, int is_isoc, int bytecount)" -->
static uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#49a9d4aa15e01fc07d68826bd05c0f4d">calc_bus_time</a> (int speed, int is_in, int is_isoc, int bytecount)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#d32f8a4be67b758e9541e33746363677">qh_init</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh, <a class="el" href="structdwc__otg__hcd__urb.html">dwc_otg_hcd_urb_t</a> *urb)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#187194b7a9f28e7f7a09ac3e345c7253">dwc_otg_hcd_qh_create</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__hcd__urb.html">dwc_otg_hcd_urb_t</a> *urb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function allocates and initializes a QH.  <a href="#187194b7a9f28e7f7a09ac3e345c7253"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#debf9d35891234a74bc00832bba603bc">periodic_channel_available</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks that a channel is available for a periodic transfer.  <a href="#debf9d35891234a74bc00832bba603bc"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#fee6145ab0fe7782c587916160dedb11">check_periodic_bandwidth</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks that there is sufficient bandwidth for the specified QH in the periodic schedule.  <a href="#fee6145ab0fe7782c587916160dedb11"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#4d3ef86a879b015bea87b02118aae4c9">check_max_xfer_size</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks that the max transfer size allowed in a host channel is large enough to handle the maximum data transfer in a single (micro)frame for a periodic transfer.  <a href="#4d3ef86a879b015bea87b02118aae4c9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#06b5d4bb36612e7da15a3727b1396a0c">schedule_periodic</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Schedules an interrupt or isochronous transfer in the periodic schedule.  <a href="#06b5d4bb36612e7da15a3727b1396a0c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#75cad4c6010d88086ddedf739db55d6b">dwc_otg_hcd_qh_add</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function adds a QH to either the non periodic or periodic schedule if it is not already in the schedule.  <a href="#75cad4c6010d88086ddedf739db55d6b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#97dd97603c01db8288a735910b3b24a7">deschedule_periodic</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Removes an interrupt or isochronous transfer from the periodic schedule.  <a href="#97dd97603c01db8288a735910b3b24a7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#506b89b01ee7692885daff1c17c894f8">dwc_otg_hcd_qh_remove</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Removes a QH from either the non-periodic or periodic schedule.  <a href="#506b89b01ee7692885daff1c17c894f8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#793c592c73cd45f15e185ea60ad83b09">dwc_otg_hcd_qh_deactivate</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh, int sched_next_periodic_split)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deactivates a QH.  <a href="#793c592c73cd45f15e185ea60ad83b09"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#5c4da8822ae027f70eda33cb783644fc">dwc_otg_hcd_qtd_create</a> (<a class="el" href="structdwc__otg__hcd__urb.html">dwc_otg_hcd_urb_t</a> *urb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function allocates and initializes a QTD.  <a href="#5c4da8822ae027f70eda33cb783644fc"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#9ebb534f604aa8f693da162f32cf1ba4">dwc_otg_hcd_qtd_init</a> (<a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a> *qtd, <a class="el" href="structdwc__otg__hcd__urb.html">dwc_otg_hcd_urb_t</a> *urb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes a QTD structure.  <a href="#9ebb534f604aa8f693da162f32cf1ba4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#c8a5d8f0fc76595496b1a0bd2f83a501">dwc_otg_hcd_qtd_add</a> (<a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a> *qtd, <a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> **qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function adds a QTD to the QTD-list of a QH.  <a href="#c8a5d8f0fc76595496b1a0bd2f83a501"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This file contains the functions to manage Queue Heads and Queue Transfer Descriptors. 
<p>

<p>
Definition in file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="86d31a59a5f7c095cd183a06edeed5e1"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::SCHEDULE_SLOP" ref="86d31a59a5f7c095cd183a06edeed5e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SCHEDULE_SLOP&nbsp;&nbsp;&nbsp;10          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initializes a QH structure. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>The QH to init. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>urb</em>&nbsp;</td><td>Holds the information about the device/endpoint that we need to initialize the QH. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00159">159</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="1ac731c0691ac3851edddc558fae79e0"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::dwc_otg_hcd_qh_free" ref="1ac731c0691ac3851edddc558fae79e0" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dwc_otg_hcd_qh_free           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Free each QTD in the QH's QTD-list then free the QH. 
<p>
QH should already be removed from a list. QTD list should already be empty if called from URB Dequeue.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>HCD instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>The QH to free. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00053">53</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="d32f8a4be67b758e9541e33746363677"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::qh_init" ref="d32f8a4be67b758e9541e33746363677" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh, dwc_otg_hcd_urb_t *urb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void qh_init           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd__urb.html">dwc_otg_hcd_urb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>urb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00160">160</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="187194b7a9f28e7f7a09ac3e345c7253"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::dwc_otg_hcd_qh_create" ref="187194b7a9f28e7f7a09ac3e345c7253" args="(dwc_otg_hcd_t *hcd, dwc_otg_hcd_urb_t *urb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a>* dwc_otg_hcd_qh_create           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd__urb.html">dwc_otg_hcd_urb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>urb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function allocates and initializes a QH. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>urb</em>&nbsp;</td><td>Holds the information about the device/endpoint that we need to initialize the QH.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Returns pointer to the newly allocated QH, or NULL on error. </dd></dl>

<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000020">Todo:</a></b></dt><dd>add memflags argument </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00296">296</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="debf9d35891234a74bc00832bba603bc"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::periodic_channel_available" ref="debf9d35891234a74bc00832bba603bc" args="(dwc_otg_hcd_t *hcd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int periodic_channel_available           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Checks that a channel is available for a periodic transfer. 
<p>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00323">323</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="fee6145ab0fe7782c587916160dedb11"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::check_periodic_bandwidth" ref="fee6145ab0fe7782c587916160dedb11" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int check_periodic_bandwidth           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Checks that there is sufficient bandwidth for the specified QH in the periodic schedule. 
<p>
For simplicity, this calculation assumes that all the transfers in the periodic schedule may occur in the same (micro)frame.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>QH containing periodic bandwidth required.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00356">356</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="4d3ef86a879b015bea87b02118aae4c9"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::check_max_xfer_size" ref="4d3ef86a879b015bea87b02118aae4c9" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int check_max_xfer_size           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Checks that the max transfer size allowed in a host channel is large enough to handle the maximum data transfer in a single (micro)frame for a periodic transfer. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>QH for a periodic endpoint.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00396">396</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="06b5d4bb36612e7da15a3727b1396a0c"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::schedule_periodic" ref="06b5d4bb36612e7da15a3727b1396a0c" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int schedule_periodic           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Schedules an interrupt or isochronous transfer in the periodic schedule. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>QH for the periodic transfer. The QH should already contain the scheduling information.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00425">425</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="75cad4c6010d88086ddedf739db55d6b"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::dwc_otg_hcd_qh_add" ref="75cad4c6010d88086ddedf739db55d6b" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dwc_otg_hcd_qh_add           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function adds a QH to either the non periodic or periodic schedule if it is not already in the schedule. 
<p>
If the QH is already in the schedule, no action is taken.<p>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00472">472</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="97dd97603c01db8288a735910b3b24a7"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::deschedule_periodic" ref="97dd97603c01db8288a735910b3b24a7" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void deschedule_periodic           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Removes an interrupt or isochronous transfer from the periodic schedule. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>QH for the periodic transfer. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00505">505</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="506b89b01ee7692885daff1c17c894f8"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::dwc_otg_hcd_qh_remove" ref="506b89b01ee7692885daff1c17c894f8" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dwc_otg_hcd_qh_remove           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Removes a QH from either the non-periodic or periodic schedule. 
<p>
Memory is not freed.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>QH to remove from schedule. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00522">522</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="793c592c73cd45f15e185ea60ad83b09"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::dwc_otg_hcd_qh_deactivate" ref="793c592c73cd45f15e185ea60ad83b09" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh, int sched_next_periodic_split)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dwc_otg_hcd_qh_deactivate           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sched_next_periodic_split</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Deactivates a QH. 
<p>
For non-periodic QHs, removes the QH from the active non-periodic schedule. The QH is added to the inactive non-periodic schedule if any QTDs are still attached to the QH.<p>
For periodic QHs, the QH is removed from the periodic queued schedule. If there are any QTDs still attached to the QH, the QH is added to either the periodic inactive schedule or the periodic ready schedule and its next scheduled frame is calculated. The QH is placed in the ready schedule if the scheduled frame has been reached already. Otherwise it's placed in the inactive schedule. If there are no QTDs attached to the QH, the QH is completely removed from the periodic schedule. 
<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00559">559</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="5c4da8822ae027f70eda33cb783644fc"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::dwc_otg_hcd_qtd_create" ref="5c4da8822ae027f70eda33cb783644fc" args="(dwc_otg_hcd_urb_t *urb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a>* dwc_otg_hcd_qtd_create           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd__urb.html">dwc_otg_hcd_urb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>urb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function allocates and initializes a QTD. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>urb</em>&nbsp;</td><td>The URB to create a QTD from. Each URB-QTD pair will end up pointing to each other so each pair should have a unique correlation.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Returns pointer to the newly allocated QTD, or NULL on error. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00643">643</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="9ebb534f604aa8f693da162f32cf1ba4"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::dwc_otg_hcd_qtd_init" ref="9ebb534f604aa8f693da162f32cf1ba4" args="(dwc_otg_qtd_t *qtd, dwc_otg_hcd_urb_t *urb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dwc_otg_hcd_qtd_init           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd__urb.html">dwc_otg_hcd_urb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>urb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initializes a QTD structure. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>qtd</em>&nbsp;</td><td>The QTD to initialize. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>urb</em>&nbsp;</td><td>The URB to use for initialization. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00661">661</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<a class="anchor" name="c8a5d8f0fc76595496b1a0bd2f83a501"></a><!-- doxytag: member="dwc_otg_hcd_queue.c::dwc_otg_hcd_qtd_add" ref="c8a5d8f0fc76595496b1a0bd2f83a501" args="(dwc_otg_qtd_t *qtd, dwc_otg_hcd_t *hcd, dwc_otg_qh_t **qh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dwc_otg_hcd_qtd_add           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> **&nbsp;</td>
          <td class="paramname"> <em>qh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function adds a QTD to the QTD-list of a QH. 
<p>
It will find the correct QH to place the QTD into. If it does not find a QH, then it will create a new QH. If the QH to which the QTD is added is not currently scheduled, it is placed into the proper schedule based on its EP type.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>qtd</em>&nbsp;</td><td>The QTD to add </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>hcd</em>&nbsp;</td><td>The DWC HCD structure </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>qh</em>&nbsp;</td><td>out parameter to return queue head</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00698">698</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Tue May 5 02:22:49 2009 for DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
