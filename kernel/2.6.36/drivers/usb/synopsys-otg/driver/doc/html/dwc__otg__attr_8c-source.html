<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver: dwc_otg_attr.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>dwc_otg_attr.c</h1><a href="dwc__otg__attr_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* ==========================================================================</span>
<a name="l00002"></a>00002 <span class="comment"> * $File: //dwh/usb_iip/dev/software/otg/linux/drivers/dwc_otg_attr.c $</span>
<a name="l00003"></a>00003 <span class="comment"> * $Revision: #35 $</span>
<a name="l00004"></a>00004 <span class="comment"> * $Date: 2009/04/03 $</span>
<a name="l00005"></a>00005 <span class="comment"> * $Change: 1225160 $</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Synopsys HS OTG Linux Software Driver and documentation (hereinafter,</span>
<a name="l00008"></a>00008 <span class="comment"> * "Software") is an Unsupported proprietary work of Synopsys, Inc. unless</span>
<a name="l00009"></a>00009 <span class="comment"> * otherwise expressly agreed to in writing between Synopsys and you.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * The Software IS NOT an item of Licensed Software or Licensed Product under</span>
<a name="l00012"></a>00012 <span class="comment"> * any End User Software License Agreement or Agreement for Licensed Product</span>
<a name="l00013"></a>00013 <span class="comment"> * with Synopsys or any supplement thereto. You are permitted to use and</span>
<a name="l00014"></a>00014 <span class="comment"> * redistribute this Software in source and binary forms, with or without</span>
<a name="l00015"></a>00015 <span class="comment"> * modification, provided that redistributions of source code must retain this</span>
<a name="l00016"></a>00016 <span class="comment"> * notice. You may not view, use, disclose, copy or distribute this file or</span>
<a name="l00017"></a>00017 <span class="comment"> * any information contained herein except pursuant to this license grant from</span>
<a name="l00018"></a>00018 <span class="comment"> * Synopsys. If you do not agree with this notice, including the disclaimer</span>
<a name="l00019"></a>00019 <span class="comment"> * below, then you are not authorized to use the Software.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * THIS SOFTWARE IS BEING DISTRIBUTED BY SYNOPSYS SOLELY ON AN "AS IS" BASIS</span>
<a name="l00022"></a>00022 <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00023"></a>00023 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00024"></a>00024 <span class="comment"> * ARE HEREBY DISCLAIMED. IN NO EVENT SHALL SYNOPSYS BE LIABLE FOR ANY DIRECT,</span>
<a name="l00025"></a>00025 <span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<a name="l00026"></a>00026 <span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<a name="l00027"></a>00027 <span class="comment"> * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="l00028"></a>00028 <span class="comment"> * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00029"></a>00029 <span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
<a name="l00030"></a>00030 <span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
<a name="l00031"></a>00031 <span class="comment"> * DAMAGE.</span>
<a name="l00032"></a>00032 <span class="comment"> * ========================================================================== */</span>
<a name="l00033"></a>00033 
<a name="l00286"></a>00286 <span class="preprocessor">#include &lt;linux/kernel.h&gt;</span>
<a name="l00287"></a>00287 <span class="preprocessor">#include &lt;linux/module.h&gt;</span>
<a name="l00288"></a>00288 <span class="preprocessor">#include &lt;linux/moduleparam.h&gt;</span>
<a name="l00289"></a>00289 <span class="preprocessor">#include &lt;linux/init.h&gt;</span>
<a name="l00290"></a>00290 <span class="preprocessor">#include &lt;linux/device.h&gt;</span>
<a name="l00291"></a>00291 <span class="preprocessor">#include &lt;linux/errno.h&gt;</span>
<a name="l00292"></a>00292 <span class="preprocessor">#include &lt;linux/types.h&gt;</span>
<a name="l00293"></a>00293 <span class="preprocessor">#include &lt;linux/stat.h&gt;</span>         <span class="comment">/* permission constants */</span>
<a name="l00294"></a>00294 <span class="preprocessor">#include &lt;linux/version.h&gt;</span>
<a name="l00295"></a>00295 <span class="preprocessor">#include &lt;linux/param.h&gt;</span>
<a name="l00296"></a>00296 <span class="preprocessor">#include &lt;linux/delay.h&gt;</span>
<a name="l00297"></a>00297 <span class="preprocessor">#include &lt;linux/jiffies.h&gt;</span>
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00301"></a>00301 <span class="preprocessor"></span><span class="preprocessor">#include &lt;asm/sizes.h&gt;</span>
<a name="l00302"></a>00302 <span class="preprocessor">#include &lt;asm/arch/lm.h&gt;</span>
<a name="l00303"></a>00303 <span class="preprocessor">#endif</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>
<a name="l00305"></a>00305 <span class="preprocessor">#include &lt;asm/io.h&gt;</span>
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 <span class="preprocessor">#include "dwc_os.h"</span>
<a name="l00308"></a>00308 <span class="preprocessor">#include "<a class="code" href="dwc__otg__driver_8h.html">dwc_otg_driver.h</a>"</span>
<a name="l00309"></a>00309 <span class="preprocessor">#include "<a class="code" href="dwc__otg__attr_8h.html">dwc_otg_attr.h</a>"</span>
<a name="l00310"></a>00310 <span class="preprocessor">#include "<a class="code" href="dwc__otg__core__if_8h.html">dwc_otg_core_if.h</a>"</span>
<a name="l00311"></a>00311 <span class="preprocessor">#include "<a class="code" href="dwc__otg__pcd__if_8h.html">dwc_otg_pcd_if.h</a>"</span>
<a name="l00312"></a>00312 <span class="preprocessor">#include "<a class="code" href="dwc__otg__hcd__if_8h.html">dwc_otg_hcd_if.h</a>"</span>
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 <span class="comment">/*</span>
<a name="l00315"></a>00315 <span class="comment"> * MACROs for defining sysfs attribute</span>
<a name="l00316"></a>00316 <span class="comment"> */</span>
<a name="l00317"></a>00317 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span>
<a name="l00319"></a>00319 <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_SHOW(_otg_attr_name_,_string_) \</span>
<a name="l00320"></a>00320 <span class="preprocessor">static ssize_t _otg_attr_name_##_show (struct device *_dev, struct device_attribute *attr, char *buf) \</span>
<a name="l00321"></a>00321 <span class="preprocessor">{ \</span>
<a name="l00322"></a>00322 <span class="preprocessor">        struct lm_device *lm_dev = container_of(_dev, struct lm_device, dev); \</span>
<a name="l00323"></a>00323 <span class="preprocessor">        dwc_otg_device_t *otg_dev = lm_get_drvdata(lm_dev);             \</span>
<a name="l00324"></a>00324 <span class="preprocessor">        uint32_t val; \</span>
<a name="l00325"></a>00325 <span class="preprocessor">        val = dwc_otg_get_##_otg_attr_name_ (otg_dev-&gt;core_if); \</span>
<a name="l00326"></a>00326 <span class="preprocessor">        return sprintf (buf, "%s = 0x%x\n", _string_, val); \</span>
<a name="l00327"></a>00327 <span class="preprocessor">}</span>
<a name="l00328"></a>00328 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_STORE(_otg_attr_name_,_string_) \</span>
<a name="l00329"></a>00329 <span class="preprocessor">static ssize_t _otg_attr_name_##_store (struct device *_dev, struct device_attribute *attr, \</span>
<a name="l00330"></a>00330 <span class="preprocessor">                                        const char *buf, size_t count) \</span>
<a name="l00331"></a>00331 <span class="preprocessor">{ \</span>
<a name="l00332"></a>00332 <span class="preprocessor">        struct lm_device *lm_dev = container_of(_dev, struct lm_device, dev); \</span>
<a name="l00333"></a>00333 <span class="preprocessor">        dwc_otg_device_t *otg_dev = lm_get_drvdata(lm_dev); \</span>
<a name="l00334"></a>00334 <span class="preprocessor">        uint32_t set = simple_strtoul(buf, NULL, 16); \</span>
<a name="l00335"></a>00335 <span class="preprocessor">        dwc_otg_set_##_otg_attr_name_(otg_dev-&gt;core_if, set);\</span>
<a name="l00336"></a>00336 <span class="preprocessor">        return count; \</span>
<a name="l00337"></a>00337 <span class="preprocessor">}</span>
<a name="l00338"></a>00338 <span class="preprocessor"></span>
<a name="l00339"></a>00339 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00340"></a>00340 <span class="preprocessor"></span>
<a name="l00341"></a>00341 <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_SHOW(_otg_attr_name_,_string_) \</span>
<a name="l00342"></a>00342 <span class="preprocessor">static ssize_t _otg_attr_name_##_show (struct device *_dev, struct device_attribute *attr, char *buf) \</span>
<a name="l00343"></a>00343 <span class="preprocessor">{ \</span>
<a name="l00344"></a>00344 <span class="preprocessor">        dwc_otg_device_t *otg_dev = dev_get_drvdata(_dev);      \</span>
<a name="l00345"></a>00345 <span class="preprocessor">        uint32_t val; \</span>
<a name="l00346"></a>00346 <span class="preprocessor">        val = dwc_otg_get_##_otg_attr_name_ (otg_dev-&gt;core_if); \</span>
<a name="l00347"></a>00347 <span class="preprocessor">        return sprintf (buf, "%s = 0x%x\n", _string_, val); \</span>
<a name="l00348"></a>00348 <span class="preprocessor">}</span>
<a name="l00349"></a>00349 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_STORE(_otg_attr_name_,_string_) \</span>
<a name="l00350"></a>00350 <span class="preprocessor">static ssize_t _otg_attr_name_##_store (struct device *_dev, struct device_attribute *attr, \</span>
<a name="l00351"></a>00351 <span class="preprocessor">                                        const char *buf, size_t count) \</span>
<a name="l00352"></a>00352 <span class="preprocessor">{ \</span>
<a name="l00353"></a>00353 <span class="preprocessor">        dwc_otg_device_t *otg_dev = dev_get_drvdata(_dev);  \</span>
<a name="l00354"></a>00354 <span class="preprocessor">        uint32_t set = simple_strtoul(buf, NULL, 16); \</span>
<a name="l00355"></a>00355 <span class="preprocessor">        dwc_otg_set_##_otg_attr_name_(otg_dev-&gt;core_if, set);\</span>
<a name="l00356"></a>00356 <span class="preprocessor">        return count; \</span>
<a name="l00357"></a>00357 <span class="preprocessor">}</span>
<a name="l00358"></a>00358 <span class="preprocessor"></span>
<a name="l00359"></a>00359 <span class="preprocessor">#endif</span>
<a name="l00360"></a>00360 <span class="preprocessor"></span>
<a name="l00361"></a>00361 <span class="comment">/*</span>
<a name="l00362"></a>00362 <span class="comment"> * MACROs for defining sysfs attribute for 32-bit registers</span>
<a name="l00363"></a>00363 <span class="comment"> */</span>
<a name="l00364"></a>00364 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00365"></a>00365 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG_SHOW(_otg_attr_name_,_string_) \</span>
<a name="l00366"></a>00366 <span class="preprocessor">static ssize_t _otg_attr_name_##_show (struct device *_dev, struct device_attribute *attr, char *buf) \</span>
<a name="l00367"></a>00367 <span class="preprocessor">{ \</span>
<a name="l00368"></a>00368 <span class="preprocessor">        struct lm_device *lm_dev = container_of(_dev, struct lm_device, dev); \</span>
<a name="l00369"></a>00369 <span class="preprocessor">        dwc_otg_device_t *otg_dev = lm_get_drvdata(lm_dev); \</span>
<a name="l00370"></a>00370 <span class="preprocessor">        uint32_t val; \</span>
<a name="l00371"></a>00371 <span class="preprocessor">        val = dwc_otg_get_##_otg_attr_name_ (otg_dev-&gt;core_if); \</span>
<a name="l00372"></a>00372 <span class="preprocessor">        return sprintf (buf, "%s = 0x%08x\n", _string_, val); \</span>
<a name="l00373"></a>00373 <span class="preprocessor">}</span>
<a name="l00374"></a>00374 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG_STORE(_otg_attr_name_,_string_) \</span>
<a name="l00375"></a>00375 <span class="preprocessor">static ssize_t _otg_attr_name_##_store (struct device *_dev, struct device_attribute *attr, \</span>
<a name="l00376"></a>00376 <span class="preprocessor">                                        const char *buf, size_t count) \</span>
<a name="l00377"></a>00377 <span class="preprocessor">{ \</span>
<a name="l00378"></a>00378 <span class="preprocessor">        struct lm_device *lm_dev = container_of(_dev, struct lm_device, dev); \</span>
<a name="l00379"></a>00379 <span class="preprocessor">        dwc_otg_device_t *otg_dev = lm_get_drvdata(lm_dev); \</span>
<a name="l00380"></a>00380 <span class="preprocessor">        uint32_t val = simple_strtoul(buf, NULL, 16); \</span>
<a name="l00381"></a>00381 <span class="preprocessor">        dwc_otg_set_##_otg_attr_name_ (otg_dev-&gt;core_if, val); \</span>
<a name="l00382"></a>00382 <span class="preprocessor">        return count; \</span>
<a name="l00383"></a>00383 <span class="preprocessor">}</span>
<a name="l00384"></a>00384 <span class="preprocessor"></span><span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00385"></a>00385 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG_SHOW(_otg_attr_name_,_string_) \</span>
<a name="l00386"></a>00386 <span class="preprocessor">static ssize_t _otg_attr_name_##_show (struct device *_dev, struct device_attribute *attr, char *buf) \</span>
<a name="l00387"></a>00387 <span class="preprocessor">{ \</span>
<a name="l00388"></a>00388 <span class="preprocessor">        dwc_otg_device_t *otg_dev = dev_get_drvdata(_dev);  \</span>
<a name="l00389"></a>00389 <span class="preprocessor">        uint32_t val; \</span>
<a name="l00390"></a>00390 <span class="preprocessor">        val = dwc_otg_get_##_otg_attr_name_ (otg_dev-&gt;core_if); \</span>
<a name="l00391"></a>00391 <span class="preprocessor">        return sprintf (buf, "%s = 0x%08x\n", _string_, val); \</span>
<a name="l00392"></a>00392 <span class="preprocessor">}</span>
<a name="l00393"></a>00393 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG_STORE(_otg_attr_name_,_string_) \</span>
<a name="l00394"></a>00394 <span class="preprocessor">static ssize_t _otg_attr_name_##_store (struct device *_dev, struct device_attribute *attr, \</span>
<a name="l00395"></a>00395 <span class="preprocessor">                                        const char *buf, size_t count) \</span>
<a name="l00396"></a>00396 <span class="preprocessor">{ \</span>
<a name="l00397"></a>00397 <span class="preprocessor">        dwc_otg_device_t *otg_dev = dev_get_drvdata(_dev);  \</span>
<a name="l00398"></a>00398 <span class="preprocessor">        uint32_t val = simple_strtoul(buf, NULL, 16); \</span>
<a name="l00399"></a>00399 <span class="preprocessor">        dwc_otg_set_##_otg_attr_name_ (otg_dev-&gt;core_if, val); \</span>
<a name="l00400"></a>00400 <span class="preprocessor">        return count; \</span>
<a name="l00401"></a>00401 <span class="preprocessor">}</span>
<a name="l00402"></a>00402 <span class="preprocessor"></span>
<a name="l00403"></a>00403 <span class="preprocessor">#endif</span>
<a name="l00404"></a>00404 <span class="preprocessor"></span>
<a name="l00405"></a><a class="code" href="dwc__otg__attr_8c.html#91eb9b8ec6d56698f0b6f4934573a41e">00405</a> <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_RW(_otg_attr_name_,_string_) \</span>
<a name="l00406"></a>00406 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_BITFIELD_SHOW(_otg_attr_name_,_string_) \</span>
<a name="l00407"></a>00407 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_BITFIELD_STORE(_otg_attr_name_,_string_) \</span>
<a name="l00408"></a>00408 <span class="preprocessor">DEVICE_ATTR(_otg_attr_name_,0644,_otg_attr_name_##_show,_otg_attr_name_##_store);</span>
<a name="l00409"></a>00409 <span class="preprocessor"></span>
<a name="l00410"></a><a class="code" href="dwc__otg__attr_8c.html#9bf160f54b6a1da72d213aa1aebfb444">00410</a> <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_RO(_otg_attr_name_,_string_) \</span>
<a name="l00411"></a>00411 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_BITFIELD_SHOW(_otg_attr_name_,_string_) \</span>
<a name="l00412"></a>00412 <span class="preprocessor">DEVICE_ATTR(_otg_attr_name_,0444,_otg_attr_name_##_show,NULL);</span>
<a name="l00413"></a>00413 <span class="preprocessor"></span>
<a name="l00414"></a><a class="code" href="dwc__otg__attr_8c.html#b7106ee2e9d5f335e6c49013ca789467">00414</a> <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG32_RW(_otg_attr_name_,_addr_,_string_) \</span>
<a name="l00415"></a>00415 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_REG_SHOW(_otg_attr_name_,_string_) \</span>
<a name="l00416"></a>00416 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_REG_STORE(_otg_attr_name_,_string_) \</span>
<a name="l00417"></a>00417 <span class="preprocessor">DEVICE_ATTR(_otg_attr_name_,0644,_otg_attr_name_##_show,_otg_attr_name_##_store);</span>
<a name="l00418"></a>00418 <span class="preprocessor"></span>
<a name="l00419"></a><a class="code" href="dwc__otg__attr_8c.html#471f9d3f4b4aa45b59be200e1b3beb87">00419</a> <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG32_RO(_otg_attr_name_,_addr_,_string_) \</span>
<a name="l00420"></a>00420 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_REG_SHOW(_otg_attr_name_,_string_) \</span>
<a name="l00421"></a>00421 <span class="preprocessor">DEVICE_ATTR(_otg_attr_name_,0444,_otg_attr_name_##_show,NULL);</span>
<a name="l00422"></a>00422 <span class="preprocessor"></span>
<a name="l00429"></a><a class="code" href="dwc__otg__attr_8c.html#ca58f009788e262a917c23784a84cb16">00429</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a7cbb871229310176b4388cbf3f2e353">regoffset_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00430"></a>00430                               <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00431"></a>00431 {
<a name="l00432"></a>00432 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00433"></a>00433 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00434"></a>00434         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00435"></a>00435 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00436"></a>00436 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00437"></a>00437 <span class="preprocessor">#endif</span>
<a name="l00438"></a>00438 <span class="preprocessor"></span>
<a name="l00439"></a>00439         <span class="keywordflow">return</span> snprintf(buf, <span class="keyword">sizeof</span>(<span class="stringliteral">"0xFFFFFFFF\n"</span>) + 1, <span class="stringliteral">"0x%08x\n"</span>,
<a name="l00440"></a>00440                         otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#d2701bc8589613bec5074968e57ce6ef">reg_offset</a>);
<a name="l00441"></a>00441 }
<a name="l00442"></a>00442 
<a name="l00446"></a><a class="code" href="dwc__otg__attr_8c.html#fc5be3dbcd075f5087ca1730661c5dc2">00446</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#fede01598333be19cc7d8787aa05cfdf">regoffset_store</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00447"></a>00447                                <span class="keyword">struct</span> device_attribute *attr,
<a name="l00448"></a>00448                                <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
<a name="l00449"></a>00449 {
<a name="l00450"></a>00450 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00451"></a>00451 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00452"></a>00452         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00453"></a>00453 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00454"></a>00454 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00455"></a>00455 <span class="preprocessor">#endif</span>
<a name="l00456"></a>00456 <span class="preprocessor"></span>
<a name="l00457"></a>00457         uint32_t offset = simple_strtoul(buf, NULL, 16);
<a name="l00458"></a>00458 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00459"></a>00459 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (offset &lt; SZ_256K) {
<a name="l00460"></a>00460 <span class="preprocessor">#elif  PCI_INTERFACE</span>
<a name="l00461"></a>00461 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (offset &lt; 0x00040000) {
<a name="l00462"></a>00462 <span class="preprocessor">#endif</span>
<a name="l00463"></a>00463 <span class="preprocessor"></span>                otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#d2701bc8589613bec5074968e57ce6ef">reg_offset</a> = offset;
<a name="l00464"></a>00464         } <span class="keywordflow">else</span> {
<a name="l00465"></a>00465                 dev_err(_dev, <span class="stringliteral">"invalid offset\n"</span>);
<a name="l00466"></a>00466         }
<a name="l00467"></a>00467 
<a name="l00468"></a><a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">00468</a>         <span class="keywordflow">return</span> count;
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#aeabf3d18b9b521d65b364cec3dcde45">regoffset</a>, S_IRUGO | <a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">S_IWUSR</a>, <a class="code" href="dwc__otg__attr_8c.html#a7cbb871229310176b4388cbf3f2e353">regoffset_show</a>, <a class="code" href="dwc__otg__attr_8c.html#fede01598333be19cc7d8787aa05cfdf">regoffset_store</a>);
<a name="l00472"></a>00472 
<a name="l00477"></a><a class="code" href="dwc__otg__attr_8c.html#bb38eb60bd43b1de364db80fd1bcdbcf">00477</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#d88d7abccfb5b9f0e2c9461a4c950114">regvalue_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00478"></a>00478                              <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00479"></a>00479 {
<a name="l00480"></a>00480 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00481"></a>00481 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00482"></a>00482         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00483"></a>00483 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00484"></a>00484 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00485"></a>00485 <span class="preprocessor">#endif</span>
<a name="l00486"></a>00486 <span class="preprocessor"></span>
<a name="l00487"></a>00487         uint32_t val;
<a name="l00488"></a>00488         <span class="keyword">volatile</span> uint32_t *addr;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="keywordflow">if</span> (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#d2701bc8589613bec5074968e57ce6ef">reg_offset</a> != 0xFFFFFFFF &amp;&amp; 0 != otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#ed96ed1109175f87fd83fa32a9c2c6fa">base</a>) {
<a name="l00491"></a>00491                 <span class="comment">/* Calculate the address */</span>
<a name="l00492"></a>00492                 addr = (uint32_t *) (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#d2701bc8589613bec5074968e57ce6ef">reg_offset</a> +
<a name="l00493"></a>00493                                      (uint8_t *) otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#ed96ed1109175f87fd83fa32a9c2c6fa">base</a>);
<a name="l00494"></a>00494                 val = dwc_read_reg32(addr);
<a name="l00495"></a>00495                 <span class="keywordflow">return</span> snprintf(buf,
<a name="l00496"></a>00496                                 <span class="keyword">sizeof</span>(<span class="stringliteral">"Reg@0xFFFFFFFF = 0xFFFFFFFF\n"</span>) + 1,
<a name="l00497"></a>00497                                 <span class="stringliteral">"Reg@0x%06x = 0x%08x\n"</span>, otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#d2701bc8589613bec5074968e57ce6ef">reg_offset</a>,
<a name="l00498"></a>00498                                 val);
<a name="l00499"></a>00499         } <span class="keywordflow">else</span> {
<a name="l00500"></a>00500                 dev_err(_dev, <span class="stringliteral">"Invalid offset (0x%0x)\n"</span>, otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#d2701bc8589613bec5074968e57ce6ef">reg_offset</a>);
<a name="l00501"></a>00501                 <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"invalid offset\n"</span>);
<a name="l00502"></a>00502         }
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00510"></a><a class="code" href="dwc__otg__attr_8c.html#7db6b85ac60be49f52987e615a01408b">00510</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#decb71de8ca4344042f5230b8fdadc86">regvalue_store</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00511"></a>00511                               <span class="keyword">struct</span> device_attribute *attr,
<a name="l00512"></a>00512                               <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
<a name="l00513"></a>00513 {
<a name="l00514"></a>00514 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00515"></a>00515 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00516"></a>00516         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00517"></a>00517 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00518"></a>00518 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00519"></a>00519 <span class="preprocessor">#endif</span>
<a name="l00520"></a>00520 <span class="preprocessor"></span>
<a name="l00521"></a>00521         <span class="keyword">volatile</span> uint32_t *addr;
<a name="l00522"></a>00522         uint32_t val = simple_strtoul(buf, NULL, 16);
<a name="l00523"></a>00523         <span class="comment">//dev_dbg(_dev, "Offset=0x%08x Val=0x%08x\n", otg_dev-&gt;reg_offset, val);</span>
<a name="l00524"></a>00524         <span class="keywordflow">if</span> (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#d2701bc8589613bec5074968e57ce6ef">reg_offset</a> != 0xFFFFFFFF &amp;&amp; 0 != otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#ed96ed1109175f87fd83fa32a9c2c6fa">base</a>) {
<a name="l00525"></a>00525                 <span class="comment">/* Calculate the address */</span>
<a name="l00526"></a>00526                 addr = (uint32_t *) (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#d2701bc8589613bec5074968e57ce6ef">reg_offset</a> +
<a name="l00527"></a>00527                                      (uint8_t *) otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#ed96ed1109175f87fd83fa32a9c2c6fa">base</a>);
<a name="l00528"></a>00528                 dwc_write_reg32(addr, val);
<a name="l00529"></a>00529         } <span class="keywordflow">else</span> {
<a name="l00530"></a>00530                 dev_err(_dev, <span class="stringliteral">"Invalid Register Offset (0x%08x)\n"</span>,
<a name="l00531"></a>00531                         otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#d2701bc8589613bec5074968e57ce6ef">reg_offset</a>);
<a name="l00532"></a>00532         }
<a name="l00533"></a>00533         <span class="keywordflow">return</span> count;
<a name="l00534"></a>00534 }
<a name="l00535"></a>00535 
<a name="l00536"></a><a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">00536</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#c246d9ba494611cb5b3054a71bf21d22">regvalue</a>, S_IRUGO | <a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">S_IWUSR</a>, <a class="code" href="dwc__otg__attr_8c.html#d88d7abccfb5b9f0e2c9461a4c950114">regvalue_show</a>, <a class="code" href="dwc__otg__attr_8c.html#decb71de8ca4344042f5230b8fdadc86">regvalue_store</a>);
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 <span class="comment">/*</span>
<a name="l00539"></a>00539 <span class="comment"> * Attributes</span>
<a name="l00540"></a>00540 <span class="comment"> */</span>
<a name="l00541"></a><a class="code" href="dwc__otg__attr_8c.html#a6ede17e817a37b1207d7a82147a8e57">00541</a> <a class="code" href="dwc__otg__attr_8c.html#9bf160f54b6a1da72d213aa1aebfb444">DWC_OTG_DEVICE_ATTR_BITFIELD_RO</a>(mode, <span class="stringliteral">"Mode"</span>);
<a name="l00542"></a>00542 <a class="code" href="dwc__otg__attr_8c.html#91eb9b8ec6d56698f0b6f4934573a41e">DWC_OTG_DEVICE_ATTR_BITFIELD_RW</a>(hnpcapable, <span class="stringliteral">"HNPCapable"</span>);
<a name="l00543"></a>00543 <a class="code" href="dwc__otg__attr_8c.html#91eb9b8ec6d56698f0b6f4934573a41e">DWC_OTG_DEVICE_ATTR_BITFIELD_RW</a>(srpcapable, <span class="stringliteral">"Mode"</span>);
<a name="l00544"></a>00544 <a class="code" href="dwc__otg__attr_8c.html#91eb9b8ec6d56698f0b6f4934573a41e">DWC_OTG_DEVICE_ATTR_BITFIELD_RW</a>(hsic_connect, <span class="stringliteral">"HSIC Connect"</span>);
<a name="l00545"></a>00545 <a class="code" href="dwc__otg__attr_8c.html#91eb9b8ec6d56698f0b6f4934573a41e">DWC_OTG_DEVICE_ATTR_BITFIELD_RW</a>(inv_sel_hsic, <span class="stringliteral">"Invert Select HSIC"</span>);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <span class="comment">//DWC_OTG_DEVICE_ATTR_BITFIELD_RW(buspower,&amp;(otg_dev-&gt;core_if-&gt;core_global_regs-&gt;gotgctl),(1&lt;&lt;8),8,"Mode");</span>
<a name="l00548"></a>00548 <span class="comment">//DWC_OTG_DEVICE_ATTR_BITFIELD_RW(bussuspend,&amp;(otg_dev-&gt;core_if-&gt;core_global_regs-&gt;gotgctl),(1&lt;&lt;8),8,"Mode");</span>
<a name="l00549"></a>00549 <a class="code" href="dwc__otg__attr_8c.html#9bf160f54b6a1da72d213aa1aebfb444">DWC_OTG_DEVICE_ATTR_BITFIELD_RO</a>(busconnected, <span class="stringliteral">"Bus Connected"</span>);
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 <a class="code" href="dwc__otg__attr_8c.html#b7106ee2e9d5f335e6c49013ca789467">DWC_OTG_DEVICE_ATTR_REG32_RW</a>(gotgctl, 0, <span class="stringliteral">"GOTGCTL"</span>);
<a name="l00552"></a>00552 <a class="code" href="dwc__otg__attr_8c.html#b7106ee2e9d5f335e6c49013ca789467">DWC_OTG_DEVICE_ATTR_REG32_RW</a>(gusbcfg,
<a name="l00553"></a>00553                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#909eae7e3b9432ca1e278b99f7811f52">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#ef39e181e246447df47c56aa4e37cc42">gusbcfg</a>),
<a name="l00554"></a>00554                              <span class="stringliteral">"GUSBCFG"</span>);
<a name="l00555"></a>00555 <a class="code" href="dwc__otg__attr_8c.html#b7106ee2e9d5f335e6c49013ca789467">DWC_OTG_DEVICE_ATTR_REG32_RW</a>(grxfsiz,
<a name="l00556"></a>00556                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#909eae7e3b9432ca1e278b99f7811f52">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#b1a8cc07a9541c9a73e864579602b79b">grxfsiz</a>),
<a name="l00557"></a>00557                              <span class="stringliteral">"GRXFSIZ"</span>);
<a name="l00558"></a>00558 <a class="code" href="dwc__otg__attr_8c.html#b7106ee2e9d5f335e6c49013ca789467">DWC_OTG_DEVICE_ATTR_REG32_RW</a>(gnptxfsiz,
<a name="l00559"></a>00559                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#909eae7e3b9432ca1e278b99f7811f52">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#20fb70fe34a1a65d085b1d4e5f8d9106">gnptxfsiz</a>),
<a name="l00560"></a>00560                              <span class="stringliteral">"GNPTXFSIZ"</span>);
<a name="l00561"></a>00561 <a class="code" href="dwc__otg__attr_8c.html#b7106ee2e9d5f335e6c49013ca789467">DWC_OTG_DEVICE_ATTR_REG32_RW</a>(gpvndctl,
<a name="l00562"></a>00562                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#909eae7e3b9432ca1e278b99f7811f52">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#a12db668367caef8386d2ba20289e437">gpvndctl</a>),
<a name="l00563"></a>00563                              <span class="stringliteral">"GPVNDCTL"</span>);
<a name="l00564"></a>00564 <a class="code" href="dwc__otg__attr_8c.html#b7106ee2e9d5f335e6c49013ca789467">DWC_OTG_DEVICE_ATTR_REG32_RW</a>(ggpio,
<a name="l00565"></a>00565                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#909eae7e3b9432ca1e278b99f7811f52">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#694546400c443d41b449772c8573f3e8">ggpio</a>),
<a name="l00566"></a>00566                              <span class="stringliteral">"GGPIO"</span>);
<a name="l00567"></a>00567 <a class="code" href="dwc__otg__attr_8c.html#b7106ee2e9d5f335e6c49013ca789467">DWC_OTG_DEVICE_ATTR_REG32_RW</a>(guid, &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#909eae7e3b9432ca1e278b99f7811f52">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#8735ca2e93c1e984ac2d5bcf0cda96d7">guid</a>),
<a name="l00568"></a>00568                              <span class="stringliteral">"GUID"</span>);
<a name="l00569"></a>00569 <a class="code" href="dwc__otg__attr_8c.html#471f9d3f4b4aa45b59be200e1b3beb87">DWC_OTG_DEVICE_ATTR_REG32_RO</a>(gsnpsid,
<a name="l00570"></a>00570                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#909eae7e3b9432ca1e278b99f7811f52">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#30798436df220217c3960ac4a46710dc">gsnpsid</a>),
<a name="l00571"></a>00571                              <span class="stringliteral">"GSNPSID"</span>);
<a name="l00572"></a>00572 <a class="code" href="dwc__otg__attr_8c.html#91eb9b8ec6d56698f0b6f4934573a41e">DWC_OTG_DEVICE_ATTR_BITFIELD_RW</a>(devspeed, <span class="stringliteral">"Device Speed"</span>);
<a name="l00573"></a>00573 <a class="code" href="dwc__otg__attr_8c.html#9bf160f54b6a1da72d213aa1aebfb444">DWC_OTG_DEVICE_ATTR_BITFIELD_RO</a>(enumspeed, <span class="stringliteral">"Device Enumeration Speed"</span>);
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 <a class="code" href="dwc__otg__attr_8c.html#471f9d3f4b4aa45b59be200e1b3beb87">DWC_OTG_DEVICE_ATTR_REG32_RO</a>(hptxfsiz,
<a name="l00576"></a>00576                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#909eae7e3b9432ca1e278b99f7811f52">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#94ae41f04d5a4244a8ebc23e51187e96">hptxfsiz</a>),
<a name="l00577"></a>00577                              <span class="stringliteral">"HPTXFSIZ"</span>);
<a name="l00578"></a>00578 <a class="code" href="dwc__otg__attr_8c.html#b7106ee2e9d5f335e6c49013ca789467">DWC_OTG_DEVICE_ATTR_REG32_RW</a>(hprt0, otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#51bac71891b5f6f435d7fc4582b974c1">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#dc8fe33e0bb3829cafa884d5fc603c4d">hprt0</a>, <span class="stringliteral">"HPRT0"</span>);
<a name="l00579"></a>00579 
<a name="l00586"></a>00586 <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#5ed0f5e2094b1db679075adf2f81e10a">hnp_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00587"></a>00587                         <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00588"></a>00588 {
<a name="l00589"></a>00589 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00590"></a>00590 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00591"></a>00591         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00592"></a>00592 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00593"></a>00593 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00594"></a>00594 <span class="preprocessor">#endif</span>
<a name="l00595"></a>00595 <span class="preprocessor"></span>        <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"HstNegScs = 0x%x\n"</span>,
<a name="l00596"></a>00596                        <a class="code" href="dwc__otg__cil_8c.html#df391379aafa69a8683bb1f88c413675">dwc_otg_get_hnpstatus</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>));
<a name="l00597"></a>00597 }
<a name="l00598"></a>00598 
<a name="l00602"></a><a class="code" href="dwc__otg__attr_8c.html#14b1910d541301f5456e2a15a3b4f0b0">00602</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#8c009b0959c53d9bc868afa4572db7a1">hnp_store</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00603"></a>00603                          <span class="keyword">struct</span> device_attribute *attr,
<a name="l00604"></a>00604                          <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
<a name="l00605"></a>00605 {
<a name="l00606"></a>00606 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00607"></a>00607 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00608"></a>00608         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00609"></a>00609 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00610"></a>00610 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00611"></a>00611 <span class="preprocessor">#endif</span>
<a name="l00612"></a>00612 <span class="preprocessor"></span>        uint32_t in = simple_strtoul(buf, NULL, 16);
<a name="l00613"></a>00613         <a class="code" href="dwc__otg__cil_8c.html#5cab27b65ed5a6a1e31c0e4df1650f0e">dwc_otg_set_hnpreq</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>, in);
<a name="l00614"></a>00614         <span class="keywordflow">return</span> count;
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00617"></a><a class="code" href="dwc__otg__attr_8c.html#8c009b0959c53d9bc868afa4572db7a1">00617</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#2d1cf91c8e20bcdd4f552c410b0aa6ba">hnp</a>, 0644, <a class="code" href="dwc__otg__attr_8c.html#5ed0f5e2094b1db679075adf2f81e10a">hnp_show</a>, <a class="code" href="dwc__otg__attr_8c.html#8c009b0959c53d9bc868afa4572db7a1">hnp_store</a>);
<a name="l00618"></a>00618 
<a name="l00625"></a><a class="code" href="dwc__otg__attr_8c.html#9e8313bb6a0f54484d279b2e28269712">00625</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#1ca3f5bc52a2523ca16a4fe5eafee0df">srp_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00626"></a>00626                         <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00627"></a>00627 {
<a name="l00628"></a>00628 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
<a name="l00629"></a>00629 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00630"></a>00630 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00631"></a>00631         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00632"></a>00632 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00633"></a>00633 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00634"></a>00634 <span class="preprocessor">#endif</span>
<a name="l00635"></a>00635 <span class="preprocessor"></span>        <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"SesReqScs = 0x%x\n"</span>,
<a name="l00636"></a>00636                        <a class="code" href="dwc__otg__cil_8c.html#b13eac2758aace478587df0f043e80f8">dwc_otg_get_srpstatus</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>));
<a name="l00637"></a>00637 <span class="preprocessor">#else</span>
<a name="l00638"></a>00638 <span class="preprocessor"></span>        <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Host Only Mode!\n"</span>);
<a name="l00639"></a>00639 <span class="preprocessor">#endif</span>
<a name="l00640"></a>00640 <span class="preprocessor"></span>}
<a name="l00641"></a>00641 
<a name="l00645"></a><a class="code" href="dwc__otg__attr_8c.html#80c785e24be4a8ce02d0b38a0ba5484a">00645</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#204d2d3c45a75706a28c57b396eb55c3">srp_store</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00646"></a>00646                          <span class="keyword">struct</span> device_attribute *attr,
<a name="l00647"></a>00647                          <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
<a name="l00648"></a>00648 {
<a name="l00649"></a>00649 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
<a name="l00650"></a>00650 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00652"></a>00652         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00653"></a>00653 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00654"></a>00654 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00655"></a>00655 <span class="preprocessor">#endif</span>
<a name="l00656"></a>00656 <span class="preprocessor"></span>        <a class="code" href="dwc__otg__pcd_8c.html#4be3e59162a42a79705e3ea8dc5008fa">dwc_otg_pcd_initiate_srp</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#2a8eefbd03790ea0bbb70e0ac14e4786">pcd</a>);
<a name="l00657"></a>00657 <span class="preprocessor">#endif</span>
<a name="l00658"></a>00658 <span class="preprocessor"></span>        <span class="keywordflow">return</span> count;
<a name="l00659"></a>00659 }
<a name="l00660"></a>00660 
<a name="l00661"></a><a class="code" href="dwc__otg__attr_8c.html#204d2d3c45a75706a28c57b396eb55c3">00661</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#0c2c4ba16770c40a82dbb1c33cbc2e4a">srp</a>, 0644, <a class="code" href="dwc__otg__attr_8c.html#1ca3f5bc52a2523ca16a4fe5eafee0df">srp_show</a>, <a class="code" href="dwc__otg__attr_8c.html#204d2d3c45a75706a28c57b396eb55c3">srp_store</a>);
<a name="l00662"></a>00662 
<a name="l00669"></a><a class="code" href="dwc__otg__attr_8c.html#6979f4909cde868d800dba13ef95aa8c">00669</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#d47a22e2b2f574a22c206f8b6d98e78a">buspower_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00670"></a>00670                              <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00671"></a>00671 {
<a name="l00672"></a>00672 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00673"></a>00673 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00674"></a>00674         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00675"></a>00675 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00676"></a>00676 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00677"></a>00677 <span class="preprocessor">#endif</span>
<a name="l00678"></a>00678 <span class="preprocessor"></span>        <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Bus Power = 0x%x\n"</span>,
<a name="l00679"></a>00679                        <a class="code" href="dwc__otg__cil_8c.html#83a11dae1c9563aee56baea469cd6064">dwc_otg_get_prtpower</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>));
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00685"></a><a class="code" href="dwc__otg__attr_8c.html#4514a396df18dae15f7f03f640f52ac7">00685</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#ccabb5758f6506d5b6e4120ffdc58a0e">buspower_store</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00686"></a>00686                               <span class="keyword">struct</span> device_attribute *attr,
<a name="l00687"></a>00687                               <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
<a name="l00688"></a>00688 {
<a name="l00689"></a>00689 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00690"></a>00690 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00691"></a>00691         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00692"></a>00692 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00693"></a>00693 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00694"></a>00694 <span class="preprocessor">#endif</span>
<a name="l00695"></a>00695 <span class="preprocessor"></span>        uint32_t on = simple_strtoul(buf, NULL, 16);
<a name="l00696"></a>00696         <a class="code" href="dwc__otg__cil_8c.html#63c880f915b4705a5c118b276e6e9567">dwc_otg_set_prtpower</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>, on);
<a name="l00697"></a>00697         <span class="keywordflow">return</span> count;
<a name="l00698"></a>00698 }
<a name="l00699"></a>00699 
<a name="l00700"></a><a class="code" href="dwc__otg__attr_8c.html#ccabb5758f6506d5b6e4120ffdc58a0e">00700</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#1d54646ee79d4ce4f4acd08d7d4448ce">buspower</a>, 0644, <a class="code" href="dwc__otg__attr_8c.html#d47a22e2b2f574a22c206f8b6d98e78a">buspower_show</a>, <a class="code" href="dwc__otg__attr_8c.html#ccabb5758f6506d5b6e4120ffdc58a0e">buspower_store</a>);
<a name="l00701"></a>00701 
<a name="l00708"></a><a class="code" href="dwc__otg__attr_8c.html#ae1f7e3a17c5a0bcc5a93096aeb902d2">00708</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#638d5fb77692c7445831d1fe71bbc877">bussuspend_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00709"></a>00709                                <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00710"></a>00710 {
<a name="l00711"></a>00711 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00712"></a>00712 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00713"></a>00713         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00714"></a>00714 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00715"></a>00715 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00716"></a>00716 <span class="preprocessor">#endif</span>
<a name="l00717"></a>00717 <span class="preprocessor"></span>
<a name="l00718"></a>00718         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Bus Suspend = 0x%x\n"</span>,
<a name="l00719"></a>00719                        <a class="code" href="dwc__otg__cil_8c.html#65b0861f7d5d604fb97e599adac62642">dwc_otg_get_prtsuspend</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>));
<a name="l00720"></a>00720 }
<a name="l00721"></a>00721 
<a name="l00725"></a><a class="code" href="dwc__otg__attr_8c.html#f218d7c4c611b97dfaa1e03ac2daa353">00725</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#6441ce2449145d6d2008a21a36f458a5">bussuspend_store</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00726"></a>00726                                 <span class="keyword">struct</span> device_attribute *attr,
<a name="l00727"></a>00727                                 <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
<a name="l00728"></a>00728 {
<a name="l00729"></a>00729 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00730"></a>00730 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00731"></a>00731         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00732"></a>00732 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00733"></a>00733 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00734"></a>00734 <span class="preprocessor">#endif</span>
<a name="l00735"></a>00735 <span class="preprocessor"></span>
<a name="l00736"></a>00736         uint32_t in = simple_strtoul(buf, NULL, 16);
<a name="l00737"></a>00737         <a class="code" href="dwc__otg__cil_8c.html#c072cef5b7d3c5566ad3be010c6d49ed">dwc_otg_set_prtsuspend</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>, in);
<a name="l00738"></a>00738         <span class="keywordflow">return</span> count;
<a name="l00739"></a>00739 }
<a name="l00740"></a>00740 
<a name="l00741"></a><a class="code" href="dwc__otg__attr_8c.html#6441ce2449145d6d2008a21a36f458a5">00741</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#e3c6534cdd3e1b7e83bf48e745d44c64">bussuspend</a>, 0644, <a class="code" href="dwc__otg__attr_8c.html#638d5fb77692c7445831d1fe71bbc877">bussuspend_show</a>, <a class="code" href="dwc__otg__attr_8c.html#6441ce2449145d6d2008a21a36f458a5">bussuspend_store</a>);
<a name="l00742"></a>00742 
<a name="l00746"></a><a class="code" href="dwc__otg__attr_8c.html#3321551071eb0987630d501c377ff095">00746</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#d3c8b864074e133b8d1a11ee88e69a05">remote_wakeup_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00747"></a>00747                                   <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00748"></a>00748 {
<a name="l00749"></a>00749 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
<a name="l00750"></a>00750 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00751"></a>00751 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00752"></a>00752         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00753"></a>00753 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00754"></a>00754 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00755"></a>00755 <span class="preprocessor">#endif</span>
<a name="l00756"></a>00756 <span class="preprocessor"></span>
<a name="l00757"></a>00757         <span class="keywordflow">return</span> sprintf(buf,
<a name="l00758"></a>00758                        <span class="stringliteral">"Remote Wakeup Sig = %d Enabled = %d LPM Remote Wakeup = %d\n"</span>,
<a name="l00759"></a>00759                        <a class="code" href="dwc__otg__cil_8c.html#285696198299e317222544aa912b2c35">dwc_otg_get_remotewakesig</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>),
<a name="l00760"></a>00760                        <a class="code" href="dwc__otg__pcd_8c.html#0107dd39d549d3e10fd388337e03aeb9">dwc_otg_pcd_get_rmwkup_enable</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#2a8eefbd03790ea0bbb70e0ac14e4786">pcd</a>),
<a name="l00761"></a>00761                        <a class="code" href="dwc__otg__cil_8c.html#91d2a6b57c7216fd5c6dc981a5f0e1ae">dwc_otg_get_lpm_remotewakeenabled</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>));
<a name="l00762"></a>00762 <span class="preprocessor">#else</span>
<a name="l00763"></a>00763 <span class="preprocessor"></span>        <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Host Only Mode!\n"</span>);
<a name="l00764"></a>00764 <span class="preprocessor">#endif </span><span class="comment">/* DWC_HOST_ONLY */</span>
<a name="l00765"></a>00765 }
<a name="l00766"></a>00766 
<a name="l00773"></a><a class="code" href="dwc__otg__attr_8c.html#e64972f2160646d9d707a97366eba56c">00773</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#5fe962daf09b0bc23527817b51da4d01">remote_wakeup_store</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00774"></a>00774                                    <span class="keyword">struct</span> device_attribute *attr,
<a name="l00775"></a>00775                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
<a name="l00776"></a>00776 {
<a name="l00777"></a>00777 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
<a name="l00778"></a>00778 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00779"></a>00779 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00780"></a>00780         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00781"></a>00781 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00782"></a>00782 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00783"></a>00783 <span class="preprocessor">#endif</span>
<a name="l00784"></a>00784 <span class="preprocessor"></span>
<a name="l00785"></a>00785         uint32_t val = simple_strtoul(buf, NULL, 16);
<a name="l00786"></a>00786 
<a name="l00787"></a>00787         <span class="keywordflow">if</span> (val &amp; 1) {
<a name="l00788"></a>00788                 <a class="code" href="dwc__otg__pcd_8c.html#24cbdd57c573d864a09a30ae3ecda89a">dwc_otg_pcd_remote_wakeup</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#2a8eefbd03790ea0bbb70e0ac14e4786">pcd</a>, 1);
<a name="l00789"></a>00789         } <span class="keywordflow">else</span> {
<a name="l00790"></a>00790                 <a class="code" href="dwc__otg__pcd_8c.html#24cbdd57c573d864a09a30ae3ecda89a">dwc_otg_pcd_remote_wakeup</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#2a8eefbd03790ea0bbb70e0ac14e4786">pcd</a>, 0);
<a name="l00791"></a>00791         }
<a name="l00792"></a>00792 <span class="preprocessor">#endif </span><span class="comment">/* DWC_HOST_ONLY */</span>
<a name="l00793"></a>00793         <span class="keywordflow">return</span> count;
<a name="l00794"></a>00794 }
<a name="l00795"></a>00795 
<a name="l00796"></a><a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">00796</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#f3afff970133d773b5414f1f0f2becfe">remote_wakeup</a>, S_IRUGO | <a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">S_IWUSR</a>, <a class="code" href="dwc__otg__attr_8c.html#d3c8b864074e133b8d1a11ee88e69a05">remote_wakeup_show</a>,
<a name="l00797"></a>00797             <a class="code" href="dwc__otg__attr_8c.html#5fe962daf09b0bc23527817b51da4d01">remote_wakeup_store</a>);
<a name="l00798"></a>00798 
<a name="l00803"></a><a class="code" href="dwc__otg__attr_8c.html#36728dcc762e9cbdbc9543c8b780df68">00803</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#51243ef08f84d463dbb4a1a564222229">regdump_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00804"></a>00804                             <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00805"></a>00805 {
<a name="l00806"></a>00806 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00807"></a>00807 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00808"></a>00808         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00809"></a>00809 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00810"></a>00810 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00811"></a>00811 <span class="preprocessor">#endif</span>
<a name="l00812"></a>00812 <span class="preprocessor"></span>
<a name="l00813"></a>00813         <a class="code" href="dwc__otg__cil_8c.html#118ecda931e2b745f76fde129ff707c2">dwc_otg_dump_global_registers</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>);
<a name="l00814"></a>00814         <span class="keywordflow">if</span> (<a class="code" href="dwc__otg__cil_8c.html#f0bfe5f933e21a94ea06c96ffc086e72">dwc_otg_is_host_mode</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>)) {
<a name="l00815"></a>00815                 <a class="code" href="dwc__otg__cil_8c.html#e85d3d04799b17226fcb00ea2074ca63">dwc_otg_dump_host_registers</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>);
<a name="l00816"></a>00816         } <span class="keywordflow">else</span> {
<a name="l00817"></a>00817                 <a class="code" href="dwc__otg__cil_8c.html#ea3bce6af9d0bd9b2fb6de94f1c7a133">dwc_otg_dump_dev_registers</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>);
<a name="l00818"></a>00818 
<a name="l00819"></a>00819         }
<a name="l00820"></a>00820         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Register Dump\n"</span>);
<a name="l00821"></a>00821 }
<a name="l00822"></a>00822 
<a name="l00823"></a><a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">00823</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#8db089dfccee4ac4de5f89814ddd42fc">regdump</a>, S_IRUGO | <a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">S_IWUSR</a>, <a class="code" href="dwc__otg__attr_8c.html#51243ef08f84d463dbb4a1a564222229">regdump_show</a>, 0);
<a name="l00824"></a>00824 
<a name="l00829"></a><a class="code" href="dwc__otg__attr_8c.html#e98e139afbb50f9d989ddbef2f0dbd6e">00829</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#5e7475d07adbb4380c57d019ab9e5af1">spramdump_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00830"></a>00830                               <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00831"></a>00831 {
<a name="l00832"></a>00832 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00833"></a>00833 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00834"></a>00834         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00835"></a>00835 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00836"></a>00836 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00837"></a>00837 <span class="preprocessor">#endif</span>
<a name="l00838"></a>00838 <span class="preprocessor"></span>
<a name="l00839"></a>00839         <a class="code" href="dwc__otg__cil_8c.html#393e65ddcbaed38935ea06fb7451167b">dwc_otg_dump_spram</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>);
<a name="l00840"></a>00840 
<a name="l00841"></a>00841         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"SPRAM Dump\n"</span>);
<a name="l00842"></a>00842 }
<a name="l00843"></a>00843 
<a name="l00844"></a><a class="code" href="dwc__otg__attr_8c.html#5e7475d07adbb4380c57d019ab9e5af1">00844</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#d24c69237b2acf90968b763e467e9ec9">spramdump</a>, S_IRUGO | <a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">S_IWUSR</a>, <a class="code" href="dwc__otg__attr_8c.html#5e7475d07adbb4380c57d019ab9e5af1">spramdump_show</a>, 0);
<a name="l00845"></a>00845 
<a name="l00849"></a><a class="code" href="dwc__otg__attr_8c.html#e16d4439b6b733715ecc1d06ed999aa4">00849</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#51e3893bb30f2102c68b39ef361457b0">hcddump_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00850"></a>00850                             <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00851"></a>00851 {
<a name="l00852"></a>00852 <span class="preprocessor">#ifndef DWC_DEVICE_ONLY</span>
<a name="l00853"></a>00853 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00854"></a>00854 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00855"></a>00855         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00856"></a>00856 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00857"></a>00857 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00858"></a>00858 <span class="preprocessor">#endif</span>
<a name="l00859"></a>00859 <span class="preprocessor"></span>
<a name="l00860"></a>00860         <a class="code" href="dwc__otg__hcd_8c.html#464f920221173fe04c756a9d6657f321">dwc_otg_hcd_dump_state</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#834ef28e884f0d7fcac68f3bdf5c4b33">hcd</a>);
<a name="l00861"></a>00861 <span class="preprocessor">#endif </span><span class="comment">/* DWC_DEVICE_ONLY */</span>
<a name="l00862"></a>00862         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"HCD Dump\n"</span>);
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a><a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">00865</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#eb95151b5afaea479812773b61c402b4">hcddump</a>, S_IRUGO | <a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">S_IWUSR</a>, <a class="code" href="dwc__otg__attr_8c.html#51e3893bb30f2102c68b39ef361457b0">hcddump_show</a>, 0);
<a name="l00866"></a>00866 
<a name="l00872"></a><a class="code" href="dwc__otg__attr_8c.html#d1d9d9abd2011c79fe7453c20e03e31a">00872</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#95ea28023a1ac497504fc5868d3b4d66">hcd_frrem_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00873"></a>00873                               <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00874"></a>00874 {
<a name="l00875"></a>00875 <span class="preprocessor">#ifndef DWC_DEVICE_ONLY</span>
<a name="l00876"></a>00876 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00877"></a>00877 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00878"></a>00878         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00879"></a>00879 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00880"></a>00880 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00881"></a>00881 <span class="preprocessor">#endif</span>
<a name="l00882"></a>00882 <span class="preprocessor"></span>
<a name="l00883"></a>00883         <a class="code" href="dwc__otg__hcd_8c.html#b2c46e92cdc57b1783f445ed60cc3f38">dwc_otg_hcd_dump_frrem</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#834ef28e884f0d7fcac68f3bdf5c4b33">hcd</a>);
<a name="l00884"></a>00884 <span class="preprocessor">#endif </span><span class="comment">/* DWC_DEVICE_ONLY */</span>
<a name="l00885"></a>00885         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"HCD Dump Frame Remaining\n"</span>);
<a name="l00886"></a>00886 }
<a name="l00887"></a>00887 
<a name="l00888"></a><a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">00888</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#98c5b16a6162e4c9057aee72a7216efb">hcd_frrem</a>, S_IRUGO | <a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">S_IWUSR</a>, <a class="code" href="dwc__otg__attr_8c.html#95ea28023a1ac497504fc5868d3b4d66">hcd_frrem_show</a>, 0);
<a name="l00889"></a>00889 
<a name="l00894"></a><a class="code" href="dwc__otg__attr_8c.html#5f954c85228b04a896cab754ab56358e">00894</a> <span class="preprocessor">#define RW_REG_COUNT 10000000</span>
<a name="l00895"></a><a class="code" href="dwc__otg__attr_8c.html#4e04f10b5ae5b78f1bc8b3c2e8af8f92">00895</a> <span class="preprocessor"></span><span class="preprocessor">#define MSEC_PER_JIFFIE 1000/HZ</span>
<a name="l00896"></a><a class="code" href="dwc__otg__attr_8c.html#81946b90c6e16e9596d9b9ccd1d54476">00896</a> <span class="preprocessor"></span><span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#3a4e297d31636537346c61e2e04de115">rd_reg_test_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00897"></a>00897                                 <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00898"></a>00898 {
<a name="l00899"></a>00899 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00900"></a>00900 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00901"></a>00901         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00902"></a>00902 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00903"></a>00903 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00904"></a>00904 <span class="preprocessor">#endif</span>
<a name="l00905"></a>00905 <span class="preprocessor"></span>
<a name="l00906"></a>00906         <span class="keywordtype">int</span> i;
<a name="l00907"></a>00907         <span class="keywordtype">int</span> time;
<a name="l00908"></a>00908         <span class="keywordtype">int</span> start_jiffies;
<a name="l00909"></a>00909 
<a name="l00910"></a>00910         printk(<span class="stringliteral">"HZ %d, MSEC_PER_JIFFIE %d, loops_per_jiffy %lu\n"</span>,
<a name="l00911"></a>00911                HZ, <a class="code" href="dwc__otg__attr_8c.html#4e04f10b5ae5b78f1bc8b3c2e8af8f92">MSEC_PER_JIFFIE</a>, loops_per_jiffy);
<a name="l00912"></a>00912         start_jiffies = jiffies;
<a name="l00913"></a>00913         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="dwc__otg__attr_8c.html#5f954c85228b04a896cab754ab56358e">RW_REG_COUNT</a>; i++) {
<a name="l00914"></a>00914                 <a class="code" href="dwc__otg__cil_8c.html#3110e552598b04bbe6b30bcddadda98b">dwc_otg_get_gnptxfsiz</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>);
<a name="l00915"></a>00915         }
<a name="l00916"></a>00916         time = jiffies - start_jiffies;
<a name="l00917"></a>00917         <span class="keywordflow">return</span> sprintf(buf,
<a name="l00918"></a>00918                        <span class="stringliteral">"Time to read GNPTXFSIZ reg %d times: %d msecs (%d jiffies)\n"</span>,
<a name="l00919"></a>00919                        RW_REG_COUNT, time * <a class="code" href="dwc__otg__attr_8c.html#4e04f10b5ae5b78f1bc8b3c2e8af8f92">MSEC_PER_JIFFIE</a>, time);
<a name="l00920"></a>00920 }
<a name="l00921"></a>00921 
<a name="l00922"></a><a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">00922</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#829fa87e3e65ff4038b6bc0eb2a93fb7">rd_reg_test</a>, S_IRUGO | <a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">S_IWUSR</a>, <a class="code" href="dwc__otg__attr_8c.html#3a4e297d31636537346c61e2e04de115">rd_reg_test_show</a>, 0);
<a name="l00923"></a>00923 
<a name="l00928"></a><a class="code" href="dwc__otg__attr_8c.html#9dd7132e3f334eed0e27e11ab5f7b0c4">00928</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#bc692a23b59ffdb09d9ef3fd468fbff7">wr_reg_test_show</a>(<span class="keyword">struct</span> device *_dev,
<a name="l00929"></a>00929                                 <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00930"></a>00930 {
<a name="l00931"></a>00931 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00932"></a>00932 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00933"></a>00933         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00934"></a>00934 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00935"></a>00935 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00936"></a>00936 <span class="preprocessor">#endif</span>
<a name="l00937"></a>00937 <span class="preprocessor"></span>
<a name="l00938"></a>00938         uint32_t reg_val;
<a name="l00939"></a>00939         <span class="keywordtype">int</span> i;
<a name="l00940"></a>00940         <span class="keywordtype">int</span> time;
<a name="l00941"></a>00941         <span class="keywordtype">int</span> start_jiffies;
<a name="l00942"></a>00942 
<a name="l00943"></a>00943         printk(<span class="stringliteral">"HZ %d, MSEC_PER_JIFFIE %d, loops_per_jiffy %lu\n"</span>,
<a name="l00944"></a>00944                HZ, <a class="code" href="dwc__otg__attr_8c.html#4e04f10b5ae5b78f1bc8b3c2e8af8f92">MSEC_PER_JIFFIE</a>, loops_per_jiffy);
<a name="l00945"></a>00945         reg_val = <a class="code" href="dwc__otg__cil_8c.html#3110e552598b04bbe6b30bcddadda98b">dwc_otg_get_gnptxfsiz</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>);
<a name="l00946"></a>00946         start_jiffies = jiffies;
<a name="l00947"></a>00947         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="dwc__otg__attr_8c.html#5f954c85228b04a896cab754ab56358e">RW_REG_COUNT</a>; i++) {
<a name="l00948"></a>00948                 <a class="code" href="dwc__otg__cil_8c.html#48c625d569671523aac60af8e2d60d7a">dwc_otg_set_gnptxfsiz</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>, reg_val);
<a name="l00949"></a>00949         }
<a name="l00950"></a>00950         time = jiffies - start_jiffies;
<a name="l00951"></a>00951         <span class="keywordflow">return</span> sprintf(buf,
<a name="l00952"></a>00952                        <span class="stringliteral">"Time to write GNPTXFSIZ reg %d times: %d msecs (%d jiffies)\n"</span>,
<a name="l00953"></a>00953                        RW_REG_COUNT, time * <a class="code" href="dwc__otg__attr_8c.html#4e04f10b5ae5b78f1bc8b3c2e8af8f92">MSEC_PER_JIFFIE</a>, time);
<a name="l00954"></a>00954 }
<a name="l00955"></a>00955 
<a name="l00956"></a><a class="code" href="dwc__otg__attr_8c.html#bc692a23b59ffdb09d9ef3fd468fbff7">00956</a> DEVICE_ATTR(<a class="code" href="dwc__otg__attr_8c.html#b46682cc35d8ddece607cdf93c124575">wr_reg_test</a>, S_IRUGO | <a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">S_IWUSR</a>, <a class="code" href="dwc__otg__attr_8c.html#bc692a23b59ffdb09d9ef3fd468fbff7">wr_reg_test_show</a>, 0);
<a name="l00957"></a>00957 
<a name="l00958"></a>00958 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
<a name="l00959"></a>00959 <span class="preprocessor"></span>
<a name="l00963"></a>00963 <span class="keyword">static</span> ssize_t lpmresp_show(<span class="keyword">struct</span> device *_dev,
<a name="l00964"></a>00964                             <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l00965"></a>00965 {
<a name="l00966"></a>00966 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00967"></a>00967 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00968"></a>00968         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00969"></a>00969 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00970"></a>00970 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00971"></a>00971 <span class="preprocessor">#endif</span>
<a name="l00972"></a>00972 <span class="preprocessor"></span>
<a name="l00973"></a>00973         <span class="keywordflow">if</span> (!<a class="code" href="dwc__otg__cil_8c.html#0e0eb29733595730396da3ddf3d0ded5">dwc_otg_get_param_lpm_enable</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>))
<a name="l00974"></a>00974                 <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"** LPM is DISABLED **\n"</span>);
<a name="l00975"></a>00975 
<a name="l00976"></a>00976         <span class="keywordflow">if</span> (!<a class="code" href="dwc__otg__cil_8c.html#e83fb22890bc54c6b06cedb751430e77">dwc_otg_is_device_mode</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>)) {
<a name="l00977"></a>00977                 <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"** Current mode is not device mode\n"</span>);
<a name="l00978"></a>00978         }
<a name="l00979"></a>00979         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"lpm_response = %d\n"</span>,
<a name="l00980"></a>00980                        <a class="code" href="dwc__otg__cil_8c.html#86d921a91b7e2b143a305283282ce36d">dwc_otg_get_lpmresponse</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>));
<a name="l00981"></a>00981 }
<a name="l00982"></a>00982 
<a name="l00986"></a>00986 <span class="keyword">static</span> ssize_t lpmresp_store(<span class="keyword">struct</span> device *_dev,
<a name="l00987"></a>00987                              <span class="keyword">struct</span> device_attribute *attr,
<a name="l00988"></a>00988                              <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
<a name="l00989"></a>00989 {
<a name="l00990"></a>00990 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l00991"></a>00991 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l00992"></a>00992         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l00993"></a>00993 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l00994"></a>00994 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l00995"></a>00995 <span class="preprocessor">#endif</span>
<a name="l00996"></a>00996 <span class="preprocessor"></span>
<a name="l00997"></a>00997         uint32_t val = simple_strtoul(buf, NULL, 16);
<a name="l00998"></a>00998 
<a name="l00999"></a>00999         <span class="keywordflow">if</span> (!<a class="code" href="dwc__otg__cil_8c.html#0e0eb29733595730396da3ddf3d0ded5">dwc_otg_get_param_lpm_enable</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>)) {
<a name="l01000"></a>01000                 <span class="keywordflow">return</span> 0;
<a name="l01001"></a>01001         }
<a name="l01002"></a>01002 
<a name="l01003"></a>01003         <span class="keywordflow">if</span> (!<a class="code" href="dwc__otg__cil_8c.html#e83fb22890bc54c6b06cedb751430e77">dwc_otg_is_device_mode</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>)) {
<a name="l01004"></a>01004                 <span class="keywordflow">return</span> 0;
<a name="l01005"></a>01005         }
<a name="l01006"></a>01006 
<a name="l01007"></a>01007         <a class="code" href="dwc__otg__cil_8c.html#b19565bc2a8dbb258c3c2cb8c52240b8">dwc_otg_set_lpmresponse</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>, val);
<a name="l01008"></a>01008         <span class="keywordflow">return</span> count;
<a name="l01009"></a>01009 }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011 DEVICE_ATTR(lpm_response, S_IRUGO | <a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">S_IWUSR</a>, lpmresp_show, lpmresp_store);
<a name="l01012"></a>01012 
<a name="l01016"></a>01016 <span class="keyword">static</span> ssize_t sleepstatus_show(<span class="keyword">struct</span> device *_dev,
<a name="l01017"></a>01017                                 <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
<a name="l01018"></a>01018 {
<a name="l01019"></a>01019 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l01020"></a>01020 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l01021"></a>01021         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l01022"></a>01022 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l01023"></a>01023 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l01024"></a>01024 <span class="preprocessor">#endif</span>
<a name="l01025"></a>01025 <span class="preprocessor"></span>
<a name="l01026"></a>01026 
<a name="l01027"></a>01027         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Sleep Status = %d\n"</span>,
<a name="l01028"></a>01028                        <a class="code" href="dwc__otg__cil_8c.html#87d643973839554bac437d283a462e00">dwc_otg_get_lpm_portsleepstatus</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>));
<a name="l01029"></a>01029 }
<a name="l01030"></a>01030 
<a name="l01034"></a>01034 <span class="keyword">static</span> ssize_t sleepstatus_store(<span class="keyword">struct</span> device *_dev,
<a name="l01035"></a>01035                                  <span class="keyword">struct</span> device_attribute *attr,
<a name="l01036"></a>01036                                  <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
<a name="l01037"></a>01037 {
<a name="l01038"></a>01038 <span class="preprocessor">#ifdef LM_INTERFACE</span>
<a name="l01039"></a>01039 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
<a name="l01040"></a>01040         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
<a name="l01041"></a>01041 <span class="preprocessor">#elif PCI_INTERFACE</span>
<a name="l01042"></a>01042 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
<a name="l01043"></a>01043 <span class="preprocessor">#endif</span>
<a name="l01044"></a>01044 <span class="preprocessor"></span>
<a name="l01045"></a>01045         <a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *core_if = otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>;
<a name="l01046"></a>01046 
<a name="l01047"></a>01047         <span class="keywordflow">if</span> (<a class="code" href="dwc__otg__cil_8c.html#87d643973839554bac437d283a462e00">dwc_otg_get_lpm_portsleepstatus</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>)) {
<a name="l01048"></a>01048                 <span class="keywordflow">if</span> (<a class="code" href="dwc__otg__cil_8c.html#f0bfe5f933e21a94ea06c96ffc086e72">dwc_otg_is_host_mode</a>(core_if)) {
<a name="l01049"></a>01049 
<a name="l01050"></a>01050                         DWC_PRINTF(<span class="stringliteral">"Host initiated resume\n"</span>);
<a name="l01051"></a>01051                         <a class="code" href="dwc__otg__cil_8c.html#b6d6b18934ba5cd4ce2cf9e68be338f5">dwc_otg_set_prtresume</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#4cc7c9f6e473072c2ed0a5e6adb25ebe">core_if</a>, 1);
<a name="l01052"></a>01052                 }
<a name="l01053"></a>01053         }
<a name="l01054"></a>01054 
<a name="l01055"></a>01055         <span class="keywordflow">return</span> count;
<a name="l01056"></a>01056 }
<a name="l01057"></a>01057 
<a name="l01058"></a>01058 DEVICE_ATTR(sleep_status, S_IRUGO | <a class="code" href="dwc__otg__attr_8c.html#ac2308832629daf78cb9dd123551cd8a">S_IWUSR</a>, sleepstatus_show,
<a name="l01059"></a>01059             sleepstatus_store);
<a name="l01060"></a>01060 
<a name="l01061"></a>01061 <span class="preprocessor">#endif                          </span><span class="comment">/* CONFIG_USB_DWC_OTG_LPM_ENABLE */</span>
<a name="l01062"></a>01062 
<a name="l01068"></a><a class="code" href="dwc__otg__attr_8h.html#a0ccc83a12d3ee16db6436d0e2fab197">01068</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__attr_8c.html#792fccf68b5f00d193f800822a5d888b">dwc_otg_attr_create</a> (
<a name="l01069"></a>01069 #ifdef LM_INTERFACE
<a name="l01070"></a>01070         <span class="keyword">struct</span> lm_device *dev
<a name="l01071"></a>01071 #elif  PCI_INTERFACE
<a name="l01072"></a>01072         <span class="keyword">struct</span> pci_dev *dev
<a name="l01073"></a>01073 #endif
<a name="l01074"></a>01074         )
<a name="l01075"></a>01075 
<a name="l01076"></a>01076 {
<a name="l01077"></a>01077         <span class="keywordtype">int</span> error;
<a name="l01078"></a>01078 
<a name="l01079"></a>01079         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_regoffset);
<a name="l01080"></a>01080         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_regvalue);
<a name="l01081"></a>01081         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_mode);
<a name="l01082"></a>01082         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hnpcapable);
<a name="l01083"></a>01083         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_srpcapable);
<a name="l01084"></a>01084         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hsic_connect);
<a name="l01085"></a>01085         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_inv_sel_hsic);
<a name="l01086"></a>01086         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hnp);
<a name="l01087"></a>01087         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_srp);
<a name="l01088"></a>01088         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_buspower);
<a name="l01089"></a>01089         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_bussuspend);
<a name="l01090"></a>01090         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_busconnected);
<a name="l01091"></a>01091         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_gotgctl);
<a name="l01092"></a>01092         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_gusbcfg);
<a name="l01093"></a>01093         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_grxfsiz);
<a name="l01094"></a>01094         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_gnptxfsiz);
<a name="l01095"></a>01095         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_gpvndctl);
<a name="l01096"></a>01096         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_ggpio);
<a name="l01097"></a>01097         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_guid);
<a name="l01098"></a>01098         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_gsnpsid);
<a name="l01099"></a>01099         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_devspeed);
<a name="l01100"></a>01100         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_enumspeed);
<a name="l01101"></a>01101         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hptxfsiz);
<a name="l01102"></a>01102         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hprt0);
<a name="l01103"></a>01103         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_remote_wakeup);
<a name="l01104"></a>01104         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_regdump);
<a name="l01105"></a>01105         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_spramdump);
<a name="l01106"></a>01106         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hcddump);
<a name="l01107"></a>01107         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hcd_frrem);
<a name="l01108"></a>01108         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_rd_reg_test);
<a name="l01109"></a>01109         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_wr_reg_test);
<a name="l01110"></a>01110 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
<a name="l01111"></a>01111 <span class="preprocessor"></span>        error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_lpm_response);
<a name="l01112"></a>01112         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_sleep_status);
<a name="l01113"></a>01113 <span class="preprocessor">#endif</span>
<a name="l01114"></a>01114 <span class="preprocessor"></span>}
<a name="l01115"></a>01115 
<a name="l01119"></a><a class="code" href="dwc__otg__attr_8h.html#4b0aa5ebf3661ec8ab5566b20c233674">01119</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__attr_8c.html#4b0aa5ebf3661ec8ab5566b20c233674">dwc_otg_attr_remove</a> (
<a name="l01120"></a>01120 #ifdef LM_INTERFACE
<a name="l01121"></a>01121         <span class="keyword">struct</span> lm_device *dev
<a name="l01122"></a>01122 #elif  PCI_INTERFACE
<a name="l01123"></a>01123         <span class="keyword">struct</span> pci_dev *dev
<a name="l01124"></a>01124 #endif
<a name="l01125"></a>01125        )
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 {
<a name="l01128"></a>01128         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_regoffset);
<a name="l01129"></a>01129         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_regvalue);
<a name="l01130"></a>01130         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_mode);
<a name="l01131"></a>01131         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hnpcapable);
<a name="l01132"></a>01132         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_srpcapable);
<a name="l01133"></a>01133         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hsic_connect);
<a name="l01134"></a>01134         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_inv_sel_hsic);
<a name="l01135"></a>01135         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hnp);
<a name="l01136"></a>01136         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_srp);
<a name="l01137"></a>01137         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_buspower);
<a name="l01138"></a>01138         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_bussuspend);
<a name="l01139"></a>01139         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_busconnected);
<a name="l01140"></a>01140         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_gotgctl);
<a name="l01141"></a>01141         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_gusbcfg);
<a name="l01142"></a>01142         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_grxfsiz);
<a name="l01143"></a>01143         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_gnptxfsiz);
<a name="l01144"></a>01144         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_gpvndctl);
<a name="l01145"></a>01145         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_ggpio);
<a name="l01146"></a>01146         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_guid);
<a name="l01147"></a>01147         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_gsnpsid);
<a name="l01148"></a>01148         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_devspeed);
<a name="l01149"></a>01149         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_enumspeed);
<a name="l01150"></a>01150         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hptxfsiz);
<a name="l01151"></a>01151         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hprt0);
<a name="l01152"></a>01152         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_remote_wakeup);
<a name="l01153"></a>01153         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_regdump);
<a name="l01154"></a>01154         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_spramdump);
<a name="l01155"></a>01155         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hcddump);
<a name="l01156"></a>01156         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hcd_frrem);
<a name="l01157"></a>01157         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_rd_reg_test);
<a name="l01158"></a>01158         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_wr_reg_test);
<a name="l01159"></a>01159 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
<a name="l01160"></a>01160 <span class="preprocessor"></span>        device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_lpm_response);
<a name="l01161"></a>01161         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_sleep_status);
<a name="l01162"></a>01162 <span class="preprocessor">#endif</span>
<a name="l01163"></a>01163 <span class="preprocessor"></span>}
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue May 5 02:22:48 2009 for DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
