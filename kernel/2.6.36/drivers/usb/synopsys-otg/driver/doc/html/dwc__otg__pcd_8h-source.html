<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver: dwc_otg_pcd.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>dwc_otg_pcd.h</h1><a href="dwc__otg__pcd_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* ==========================================================================</span>
<a name="l00002"></a>00002 <span class="comment"> * $File: //dwh/usb_iip/dev/software/otg/linux/drivers/dwc_otg_pcd.h $</span>
<a name="l00003"></a>00003 <span class="comment"> * $Revision: #39 $</span>
<a name="l00004"></a>00004 <span class="comment"> * $Date: 2008/12/16 $</span>
<a name="l00005"></a>00005 <span class="comment"> * $Change: 1153731 $</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Synopsys HS OTG Linux Software Driver and documentation (hereinafter,</span>
<a name="l00008"></a>00008 <span class="comment"> * "Software") is an Unsupported proprietary work of Synopsys, Inc. unless</span>
<a name="l00009"></a>00009 <span class="comment"> * otherwise expressly agreed to in writing between Synopsys and you.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * The Software IS NOT an item of Licensed Software or Licensed Product under</span>
<a name="l00012"></a>00012 <span class="comment"> * any End User Software License Agreement or Agreement for Licensed Product</span>
<a name="l00013"></a>00013 <span class="comment"> * with Synopsys or any supplement thereto. You are permitted to use and</span>
<a name="l00014"></a>00014 <span class="comment"> * redistribute this Software in source and binary forms, with or without</span>
<a name="l00015"></a>00015 <span class="comment"> * modification, provided that redistributions of source code must retain this</span>
<a name="l00016"></a>00016 <span class="comment"> * notice. You may not view, use, disclose, copy or distribute this file or</span>
<a name="l00017"></a>00017 <span class="comment"> * any information contained herein except pursuant to this license grant from</span>
<a name="l00018"></a>00018 <span class="comment"> * Synopsys. If you do not agree with this notice, including the disclaimer</span>
<a name="l00019"></a>00019 <span class="comment"> * below, then you are not authorized to use the Software.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * THIS SOFTWARE IS BEING DISTRIBUTED BY SYNOPSYS SOLELY ON AN "AS IS" BASIS</span>
<a name="l00022"></a>00022 <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00023"></a>00023 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00024"></a>00024 <span class="comment"> * ARE HEREBY DISCLAIMED. IN NO EVENT SHALL SYNOPSYS BE LIABLE FOR ANY DIRECT,</span>
<a name="l00025"></a>00025 <span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<a name="l00026"></a>00026 <span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<a name="l00027"></a>00027 <span class="comment"> * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="l00028"></a>00028 <span class="comment"> * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00029"></a>00029 <span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
<a name="l00030"></a>00030 <span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
<a name="l00031"></a>00031 <span class="comment"> * DAMAGE.</span>
<a name="l00032"></a>00032 <span class="comment"> * ========================================================================== */</span>
<a name="l00033"></a>00033 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#if !defined(__DWC_PCD_H__)</span>
<a name="l00035"></a><a class="code" href="dwc__otg__pcd_8h.html#ed26bb67f5785dc6e70289976637a310">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define __DWC_PCD_H__</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "usb.h"</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include "<a class="code" href="dwc__otg__cil_8h.html">dwc_otg_cil.h</a>"</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include "<a class="code" href="dwc__otg__pcd__if_8h.html">dwc_otg_pcd_if.h</a>"</span>
<a name="l00040"></a>00040 <span class="keyword">struct </span><a class="code" href="structcfiobject.html">cfiobject</a>;
<a name="l00041"></a>00041 
<a name="l00058"></a><a class="code" href="dwc__otg__pcd_8h.html#6dad4d4462e9819753acfc601889faec">00058</a> <span class="preprocessor">#define DDMA_MAX_TRANSFER_SIZE 65535</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00061"></a><a class="code" href="dwc__otg__pcd_8h.html#a1c5dc8973b5c039fd77b1e250ce29e2">00061</a> <span class="preprocessor">#define MAX_DMA_DESC_CNT 64</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00066"></a><a class="code" href="dwc__otg__pcd_8h.html#464549f9f4484651efe25b1a03692d72">00066</a> <span class="preprocessor">#define GET_CORE_IF( _pcd ) (_pcd-&gt;core_if)</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00071"></a><a class="code" href="dwc__otg__pcd_8h.html#f286abbd9be76db05fee7aebfeb61865">00071</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="dwc__otg__pcd_8h.html#f286abbd9be76db05fee7aebfeb61865">ep0_state</a> {
<a name="l00072"></a>00072         EP0_DISCONNECT,         <span class="comment">/* no host */</span>
<a name="l00073"></a>00073         EP0_IDLE,
<a name="l00074"></a>00074         EP0_IN_DATA_PHASE,
<a name="l00075"></a>00075         EP0_OUT_DATA_PHASE,
<a name="l00076"></a>00076         EP0_IN_STATUS_PHASE,
<a name="l00077"></a>00077         EP0_OUT_STATUS_PHASE,
<a name="l00078"></a>00078         EP0_STALL,
<a name="l00079"></a>00079 } <a class="code" href="dwc__otg__pcd_8h.html#70fcb6a989e5871e16f4c1c96ffe394a">ep0state_e</a>;
<a name="l00080"></a>00080 
<a name="l00082"></a>00082 <span class="keyword">struct </span><a class="code" href="structdwc__otg__pcd.html">dwc_otg_pcd</a>;
<a name="l00083"></a>00083 
<a name="l00087"></a><a class="code" href="dwc__otg__pcd_8h.html#050b65dd6f6dfd9d8527f94bdf88a937">00087</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>usb_iso_request <a class="code" href="dwc__otg__pcd_8h.html#050b65dd6f6dfd9d8527f94bdf88a937">dwc_otg_pcd_iso_request_t</a>;
<a name="l00088"></a>00088 
<a name="l00092"></a><a class="code" href="structdwc__otg__pcd__request.html">00092</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdwc__otg__pcd__request.html">dwc_otg_pcd_request</a> {
<a name="l00093"></a><a class="code" href="structdwc__otg__pcd__request.html#e0d93b64365968aa0dcf58535aecf40c">00093</a>         <span class="keywordtype">void</span> *<a class="code" href="structdwc__otg__pcd__request.html#e0d93b64365968aa0dcf58535aecf40c">priv</a>;
<a name="l00094"></a><a class="code" href="structdwc__otg__pcd__request.html#c46438f3d95146654a25cd219d7a1d5a">00094</a>         <span class="keywordtype">void</span> *<a class="code" href="structdwc__otg__pcd__request.html#c46438f3d95146654a25cd219d7a1d5a">buf</a>;
<a name="l00095"></a><a class="code" href="structdwc__otg__pcd__request.html#df93c8905495816eb0327b192938a4a1">00095</a>         dwc_dma_t <a class="code" href="structdwc__otg__pcd__request.html#df93c8905495816eb0327b192938a4a1">dma</a>;
<a name="l00096"></a><a class="code" href="structdwc__otg__pcd__request.html#3dd3fcc889bf220b048023e8b05fab61">00096</a>         uint32_t <a class="code" href="structdwc__otg__pcd__request.html#3dd3fcc889bf220b048023e8b05fab61">length</a>;
<a name="l00097"></a><a class="code" href="structdwc__otg__pcd__request.html#0fd7d659f353273d8b2b22027306a2a2">00097</a>         uint32_t <a class="code" href="structdwc__otg__pcd__request.html#0fd7d659f353273d8b2b22027306a2a2">actual</a>;
<a name="l00098"></a><a class="code" href="structdwc__otg__pcd__request.html#c2c1832d46f417b63e41b5e23def6fc6">00098</a>         <span class="keywordtype">unsigned</span> <a class="code" href="structdwc__otg__pcd__request.html#c2c1832d46f417b63e41b5e23def6fc6">sent_zlp</a>:1;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100          DWC_CIRCLEQ_ENTRY(<a class="code" href="structdwc__otg__pcd__request.html">dwc_otg_pcd_request</a>) queue_entry;
<a name="l00101"></a>00101 } <a class="code" href="structdwc__otg__pcd__request.html">dwc_otg_pcd_request_t</a>;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 DWC_CIRCLEQ_HEAD(req_list, <a class="code" href="structdwc__otg__pcd__request.html">dwc_otg_pcd_request</a>);
<a name="l00104"></a>00104 
<a name="l00109"></a><a class="code" href="structdwc__otg__pcd__ep.html">00109</a> typedef struct <a class="code" href="structdwc__otg__pcd__ep.html">dwc_otg_pcd_ep</a> {
<a name="l00111"></a><a class="code" href="structdwc__otg__pcd__ep.html#86e27843c439dd0b1d12d9bf2dc6516f">00111</a>         <span class="keyword">const</span> usb_endpoint_descriptor_t *desc;
<a name="l00112"></a>00112 
<a name="l00114"></a><a class="code" href="structdwc__otg__pcd__ep.html#71f4fa571dfdc96f62fa4869e6add300">00114</a>         <span class="keyword">struct </span>req_list queue;
<a name="l00115"></a><a class="code" href="structdwc__otg__pcd__ep.html#cce0e089118d8bf7c6278c21ded70d5a">00115</a>         <span class="keywordtype">unsigned</span> stopped:1;
<a name="l00116"></a><a class="code" href="structdwc__otg__pcd__ep.html#510fcd32761716abec5a35594a3d3ad3">00116</a>         <span class="keywordtype">unsigned</span> disabling:1;
<a name="l00117"></a><a class="code" href="structdwc__otg__pcd__ep.html#314db0fbde1d5eb9eae0cbe4fdef47a4">00117</a>         <span class="keywordtype">unsigned</span> <a class="code" href="structdwc__otg__pcd__request.html#df93c8905495816eb0327b192938a4a1">dma</a>:1;
<a name="l00118"></a><a class="code" href="structdwc__otg__pcd__ep.html#bbec681b68f2f745d1cfecfedd4e64be">00118</a>         <span class="keywordtype">unsigned</span> queue_sof:1;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="preprocessor">#ifdef DWC_EN_ISOC</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>
<a name="l00122"></a><a class="code" href="structdwc__otg__pcd__ep.html#716d3c29adc54c6822935fc2ae9bef51">00122</a>         <span class="keywordtype">void</span> *iso_req_handle;
<a name="l00123"></a>00123 <span class="preprocessor">#endif                          //_EN_ISOC_</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>
<a name="l00126"></a><a class="code" href="structdwc__otg__pcd__ep.html#6e43754ce0f3a4fe29e4d70fd58d4f8f">00126</a>         <a class="code" href="structdwc__ep.html">dwc_ep_t</a> <a class="code" href="structdwc__ep.html">dwc_ep</a>;
<a name="l00127"></a>00127 
<a name="l00129"></a><a class="code" href="structdwc__otg__pcd__ep.html#234391334e48cbd72710d08655c9ed16">00129</a>         <span class="keyword">struct </span><a class="code" href="structdwc__otg__pcd.html">dwc_otg_pcd</a> *pcd;
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="structdwc__otg__pcd__ep.html#8c8fad971c6c3b1c54d334c7f9b2d03e">00131</a>         <span class="keywordtype">void</span> *<a class="code" href="structdwc__otg__pcd__request.html#e0d93b64365968aa0dcf58535aecf40c">priv</a>;
<a name="l00132"></a>00132 } <a class="code" href="structdwc__otg__pcd__ep.html">dwc_otg_pcd_ep_t</a>;
<a name="l00133"></a>00133 
<a name="l00137"></a><a class="code" href="structdwc__otg__pcd.html">00137</a> <span class="keyword">struct </span><a class="code" href="structdwc__otg__pcd.html">dwc_otg_pcd</a> {
<a name="l00138"></a><a class="code" href="structdwc__otg__pcd.html#b7001dde5db2706707a860da0030d9e6">00138</a>         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdwc__otg__pcd__function__ops.html">dwc_otg_pcd_function_ops</a> *<a class="code" href="dwc__otg__pcd__linux_8c.html#9ce9b5e49c60906c189bee157dd68acd">fops</a>;
<a name="l00140"></a><a class="code" href="structdwc__otg__pcd.html#995be0b313ab6aefc095c598528bbd4c">00140</a>         <a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *core_if;
<a name="l00142"></a><a class="code" href="structdwc__otg__pcd.html#8f6963b3fb9ab83048c4c0697c90382a">00142</a>         <a class="code" href="dwc__otg__pcd_8h.html#70fcb6a989e5871e16f4c1c96ffe394a">ep0state_e</a> ep0state;
<a name="l00144"></a><a class="code" href="structdwc__otg__pcd.html#2c8be11c3b9c7cd02684348eb028aeb5">00144</a>         <span class="keywordtype">unsigned</span> ep0_pending:1;
<a name="l00146"></a><a class="code" href="structdwc__otg__pcd.html#cbe5c4062e140ee88f51ee916c0db0ad">00146</a>         <span class="keywordtype">unsigned</span> request_config:1;
<a name="l00148"></a><a class="code" href="structdwc__otg__pcd.html#9d8e6d7f0ad10d580d467024e258f6f5">00148</a>         <span class="keywordtype">unsigned</span> remote_wakeup_enable:1;
<a name="l00150"></a><a class="code" href="structdwc__otg__pcd.html#e09fc5322ac0d7deec2772984c10ae90">00150</a>         <span class="keywordtype">unsigned</span> b_hnp_enable:1;
<a name="l00152"></a><a class="code" href="structdwc__otg__pcd.html#e8008719644bdc23040f1a1545b7117f">00152</a>         <span class="keywordtype">unsigned</span> a_hnp_support:1;
<a name="l00154"></a><a class="code" href="structdwc__otg__pcd.html#49f2d2b04a4c07a8d53643f7681b5405">00154</a>         <span class="keywordtype">unsigned</span> a_alt_hnp_support:1;
<a name="l00156"></a><a class="code" href="structdwc__otg__pcd.html#3a0464b4ac677a7742e9b7c0c820414c">00156</a>         <span class="keywordtype">unsigned</span> request_pending;
<a name="l00157"></a>00157 
<a name="l00162"></a>00162         <span class="keyword">union </span>{
<a name="l00163"></a><a class="code" href="structdwc__otg__pcd.html#af0345bc2c877d96863ef440c923204c">00163</a>                 usb_device_request_t req;
<a name="l00164"></a><a class="code" href="structdwc__otg__pcd.html#e4fe210f7a18b9f0c393af9cdf282d56">00164</a>                 uint32_t d32[2];
<a name="l00165"></a>00165         } *setup_pkt;
<a name="l00166"></a>00166 
<a name="l00167"></a><a class="code" href="structdwc__otg__pcd.html#606d94ec61cca4c21e4dc9cb2e3b7064">00167</a>         dwc_dma_t setup_pkt_dma_handle;
<a name="l00168"></a>00168 
<a name="l00170"></a><a class="code" href="structdwc__otg__pcd.html#ca247241f78970f27e5c964fc04d47c8">00170</a>         uint16_t *status_buf;
<a name="l00171"></a><a class="code" href="structdwc__otg__pcd.html#c3880dd4ce15c515ba37b90b6e7fd293">00171</a>         dwc_dma_t status_buf_dma_handle;
<a name="l00172"></a>00172 
<a name="l00174"></a><a class="code" href="structdwc__otg__pcd.html#14f4f2a41d1305fdc0ec1806d119da89">00174</a>         <a class="code" href="structdwc__otg__pcd__ep.html">dwc_otg_pcd_ep_t</a> ep0;
<a name="l00175"></a>00175 
<a name="l00177"></a><a class="code" href="structdwc__otg__pcd.html#dbfc8c424ea3add38db96fa87219caa8">00177</a>         <a class="code" href="structdwc__otg__pcd__ep.html">dwc_otg_pcd_ep_t</a> in_ep[<a class="code" href="dwc__otg__core__if_8h.html#bfb88b45545f7685f668ac2f545674ec">MAX_EPS_CHANNELS</a> - 1];
<a name="l00179"></a><a class="code" href="structdwc__otg__pcd.html#b9e49a1d1fbca5ba9523e27c7108df30">00179</a>         <a class="code" href="structdwc__otg__pcd__ep.html">dwc_otg_pcd_ep_t</a> out_ep[<a class="code" href="dwc__otg__core__if_8h.html#bfb88b45545f7685f668ac2f545674ec">MAX_EPS_CHANNELS</a> - 1];
<a name="l00181"></a>00181 <span class="comment">//        unsigned      num_eps : 4;</span>
<a name="l00182"></a><a class="code" href="structdwc__otg__pcd.html#5d450e4d06659ab2f3b18e5c816776e4">00182</a>         dwc_spinlock_t *lock;
<a name="l00185"></a><a class="code" href="structdwc__otg__pcd.html#466fb6ae524fc970f164701db2e70246">00185</a>         dwc_timer_t *srp_timer;
<a name="l00186"></a>00186 
<a name="l00190"></a><a class="code" href="structdwc__otg__pcd.html#d1aed2eb03a93032a1ce80e3145bb81e">00190</a>         dwc_tasklet_t *test_mode_tasklet;
<a name="l00191"></a>00191 
<a name="l00193"></a><a class="code" href="structdwc__otg__pcd.html#9b45cd00cd5835aba4236529a04b28f1">00193</a>         dwc_tasklet_t *start_xfer_tasklet;
<a name="l00194"></a>00194 
<a name="l00196"></a><a class="code" href="structdwc__otg__pcd.html#577c57ee60c2ef42dce7791c85d50394">00196</a>         <span class="keywordtype">unsigned</span> test_mode;
<a name="l00200"></a>00200 <span class="preprocessor">#ifdef DWC_UTE_CFI</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>        <span class="keyword">struct </span><a class="code" href="structcfiobject.html">cfiobject</a> *cfi;
<a name="l00202"></a>00202 <span class="preprocessor">#endif</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span>
<a name="l00204"></a>00204 };
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="comment">//FIXME this functions should be static, and this prototypes should be removed</span>
<a name="l00207"></a>00207 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__pcd_8c.html#e8ef6f3d831b89a753d93489827949d3">dwc_otg_request_nuke</a>(<a class="code" href="structdwc__otg__pcd__ep.html">dwc_otg_pcd_ep_t</a> * ep);
<a name="l00208"></a>00208 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__pcd_8c.html#5c9b20abc81e0f860a8f23c90b10b59e">dwc_otg_request_done</a>(<a class="code" href="structdwc__otg__pcd__ep.html">dwc_otg_pcd_ep_t</a> * ep,
<a name="l00209"></a>00209                                  <a class="code" href="structdwc__otg__pcd__request.html">dwc_otg_pcd_request_t</a> * req, int32_t status);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211 <span class="keywordtype">void</span> <a class="code" href="dwc__otg__pcd_8c.html#b4e2c352426923d4bd519cf18b68206d">dwc_otg_iso_buffer_done</a>(<a class="code" href="structdwc__otg__pcd.html">dwc_otg_pcd_t</a> * <a class="code" href="structcfiobject.html#bab38f9fb74c1332c70029000c7d3818">pcd</a>, <a class="code" href="structdwc__otg__pcd__ep.html">dwc_otg_pcd_ep_t</a> * ep,
<a name="l00212"></a>00212                              <span class="keywordtype">void</span> *req_handle);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__pcd_8h.html#9d6d6e24faab6478aef9e2217c9b5ab9">do_test_mode</a>(<span class="keywordtype">void</span> *data);
<a name="l00215"></a>00215 <span class="preprocessor">#endif</span>
<a name="l00216"></a>00216 <span class="preprocessor"></span><span class="preprocessor">#endif                          </span><span class="comment">/* DWC_HOST_ONLY */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue May 5 02:22:48 2009 for DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
