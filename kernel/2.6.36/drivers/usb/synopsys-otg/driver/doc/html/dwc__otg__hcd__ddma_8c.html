<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver: dwc_otg_hcd_ddma.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>dwc_otg_hcd_ddma.c File Reference</h1>This file contains Descriptor DMA support implementation for host mode. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="dwc__otg__hcd_8h-source.html">dwc_otg_hcd.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="dwc__otg__regs_8h-source.html">dwc_otg_regs.h</a>&quot;</code><br>

<p>
<a href="dwc__otg__hcd__ddma_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="7aed1ace42f0421b376041d8831c9a74"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::ISOC_URB_GIVEBACK_ASAP" ref="7aed1ace42f0421b376041d8831c9a74" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#7aed1ace42f0421b376041d8831c9a74">ISOC_URB_GIVEBACK_ASAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="cf56bce31ec5dfcc2a36047c0c648784"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::MAX_ISOC_XFER_SIZE_FS" ref="cf56bce31ec5dfcc2a36047c0c648784" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#cf56bce31ec5dfcc2a36047c0c648784">MAX_ISOC_XFER_SIZE_FS</a>&nbsp;&nbsp;&nbsp;1023</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="06012eeeca2d17ee7ea304b381928c4a"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::MAX_ISOC_XFER_SIZE_HS" ref="06012eeeca2d17ee7ea304b381928c4a" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#06012eeeca2d17ee7ea304b381928c4a">MAX_ISOC_XFER_SIZE_HS</a>&nbsp;&nbsp;&nbsp;3072</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="1f389f323086b2c2697f2ab56062ead6"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::DESCNUM_THRESHOLD" ref="1f389f323086b2c2697f2ab56062ead6" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#1f389f323086b2c2697f2ab56062ead6">DESCNUM_THRESHOLD</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="cc7af33964cf891f1448376c2a57b309"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::frame_list_idx" ref="cc7af33964cf891f1448376c2a57b309" args="(uint16_t frame)" -->
static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#cc7af33964cf891f1448376c2a57b309">frame_list_idx</a> (uint16_t frame)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c4d25855998839163827c8062bd6fb8b"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::desclist_idx_inc" ref="c4d25855998839163827c8062bd6fb8b" args="(uint16_t idx, uint16_t inc, uint8_t speed)" -->
static uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#c4d25855998839163827c8062bd6fb8b">desclist_idx_inc</a> (uint16_t idx, uint16_t inc, uint8_t speed)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="13186d2e949bb38420a7a19a4530a5ad"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::desclist_idx_dec" ref="13186d2e949bb38420a7a19a4530a5ad" args="(uint16_t idx, uint16_t inc, uint8_t speed)" -->
static uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#13186d2e949bb38420a7a19a4530a5ad">desclist_idx_dec</a> (uint16_t idx, uint16_t inc, uint8_t speed)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b7563972b1dd332dde72911900756d92"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::max_desc_num" ref="b7563972b1dd332dde72911900756d92" args="(dwc_otg_qh_t *qh)" -->
static uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#b7563972b1dd332dde72911900756d92">max_desc_num</a> (<a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="357d9fe0cd782a9c88e79f47c3b58384"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::frame_incr_val" ref="357d9fe0cd782a9c88e79f47c3b58384" args="(dwc_otg_qh_t *qh)" -->
static uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#357d9fe0cd782a9c88e79f47c3b58384">frame_incr_val</a> (<a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="12375cf094e35d9be3b78da6cf621d01"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::desc_list_alloc" ref="12375cf094e35d9be3b78da6cf621d01" args="(dwc_otg_qh_t *qh)" -->
static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#12375cf094e35d9be3b78da6cf621d01">desc_list_alloc</a> (<a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c062f46629017bdeeebaf90aa65f610b"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::desc_list_free" ref="c062f46629017bdeeebaf90aa65f610b" args="(dwc_otg_qh_t *qh)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#c062f46629017bdeeebaf90aa65f610b">desc_list_free</a> (<a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="35be74597b6abe7a7d077c2c00d64dc2"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::frame_list_alloc" ref="35be74597b6abe7a7d077c2c00d64dc2" args="(dwc_otg_hcd_t *hcd)" -->
static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#35be74597b6abe7a7d077c2c00d64dc2">frame_list_alloc</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="01991072b147e11d3b7350a2ee9ee920"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::frame_list_free" ref="01991072b147e11d3b7350a2ee9ee920" args="(dwc_otg_hcd_t *hcd)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#01991072b147e11d3b7350a2ee9ee920">frame_list_free</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="5b78d71512c6143d5a50e31dc3517f6a"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::per_sched_enable" ref="5b78d71512c6143d5a50e31dc3517f6a" args="(dwc_otg_hcd_t *hcd, uint16_t fr_list_en)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#5b78d71512c6143d5a50e31dc3517f6a">per_sched_enable</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, uint16_t fr_list_en)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="693b9fdfeebc77b8132cfaf461b9c8fd"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::per_sched_disable" ref="693b9fdfeebc77b8132cfaf461b9c8fd" args="(dwc_otg_hcd_t *hcd)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#693b9fdfeebc77b8132cfaf461b9c8fd">per_sched_disable</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="46c1ec7e2bd2f1177983f6676952cfdf"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::update_frame_list" ref="46c1ec7e2bd2f1177983f6676952cfdf" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh, uint8_t enable)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#46c1ec7e2bd2f1177983f6676952cfdf">update_frame_list</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh, uint8_t enable)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="9122fdf195fad109710651bbf730ca35"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::dump_frame_list" ref="9122fdf195fad109710651bbf730ca35" args="(dwc_otg_hcd_t *hcd)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#9122fdf195fad109710651bbf730ca35">dump_frame_list</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="060f60ac2e210b5da3bbe379674d2012"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::release_channel_ddma" ref="060f60ac2e210b5da3bbe379674d2012" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#060f60ac2e210b5da3bbe379674d2012">release_channel_ddma</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#1c5498d173c5461865a5042789927ed1">dwc_otg_hcd_qh_init_ddma</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes a QH structure's Descriptor DMA related members.  <a href="#1c5498d173c5461865a5042789927ed1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#78738afd0ca62e394753f1cf196476c9">dwc_otg_hcd_qh_free_ddma</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Frees descriptor list memory associated with the QH.  <a href="#78738afd0ca62e394753f1cf196476c9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="42ed718bf245372d90fa8f92fcb69a99"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::frame_to_desc_idx" ref="42ed718bf245372d90fa8f92fcb69a99" args="(dwc_otg_qh_t *qh, uint16_t frame_idx)" -->
static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#42ed718bf245372d90fa8f92fcb69a99">frame_to_desc_idx</a> (<a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh, uint16_t frame_idx)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="f9c8d06c646b374cf34925e659142709"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::calc_starting_frame" ref="f9c8d06c646b374cf34925e659142709" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh, uint8_t *skip_frames)" -->
static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#f9c8d06c646b374cf34925e659142709">calc_starting_frame</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh, uint8_t *skip_frames)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="fc5f584eb735a394a794a3022939638a"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::recalc_initial_desc_idx" ref="fc5f584eb735a394a794a3022939638a" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#fc5f584eb735a394a794a3022939638a">recalc_initial_desc_idx</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="f2bad2e76275e230f83be94c21a0bd75"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::init_isoc_dma_desc" ref="f2bad2e76275e230f83be94c21a0bd75" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh, uint8_t skip_frames)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#f2bad2e76275e230f83be94c21a0bd75">init_isoc_dma_desc</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh, uint8_t skip_frames)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="f3630ce7f8926de36873d78a1748134f"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::init_non_isoc_dma_desc" ref="f3630ce7f8926de36873d78a1748134f" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#f3630ce7f8926de36873d78a1748134f">init_non_isoc_dma_desc</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#9b051bad5e81a6b6d74b817c741bfaf3">dwc_otg_hcd_start_xfer_ddma</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">For Control and Bulk endpoints initializes descriptor list and starts the transfer.  <a href="#9b051bad5e81a6b6d74b817c741bfaf3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="aad342d0a6056bbc5645809f24ac8507"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::complete_isoc_xfer_ddma" ref="aad342d0a6056bbc5645809f24ac8507" args="(dwc_otg_hcd_t *hcd, dwc_hc_t *hc, dwc_otg_hc_regs_t *hc_regs, dwc_otg_halt_status_e halt_status)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#aad342d0a6056bbc5645809f24ac8507">complete_isoc_xfer_ddma</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__hc.html">dwc_hc_t</a> *hc, <a class="el" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs, dwc_otg_halt_status_e halt_status)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="7a1a6af7f05278f5b7daa3b0a2d2fa4a"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::update_non_isoc_urb_state_ddma" ref="7a1a6af7f05278f5b7daa3b0a2d2fa4a" args="(dwc_otg_hcd_t *hcd, dwc_hc_t *hc, dwc_otg_qtd_t *qtd, dwc_otg_host_dma_desc_t *dma_desc, dwc_otg_halt_status_e halt_status, uint32_t n_bytes, uint8_t *xfer_done)" -->
uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#7a1a6af7f05278f5b7daa3b0a2d2fa4a">update_non_isoc_urb_state_ddma</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__hc.html">dwc_hc_t</a> *hc, <a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a> *qtd, <a class="el" href="structdwc__otg__host__dma__desc.html">dwc_otg_host_dma_desc_t</a> *dma_desc, dwc_otg_halt_status_e halt_status, uint32_t n_bytes, uint8_t *xfer_done)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="3551cf23294204324754fca2da9a99d1"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::complete_non_isoc_xfer_ddma" ref="3551cf23294204324754fca2da9a99d1" args="(dwc_otg_hcd_t *hcd, dwc_hc_t *hc, dwc_otg_hc_regs_t *hc_regs, dwc_otg_halt_status_e halt_status)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#3551cf23294204324754fca2da9a99d1">complete_non_isoc_xfer_ddma</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__hc.html">dwc_hc_t</a> *hc, <a class="el" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs, dwc_otg_halt_status_e halt_status)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__ddma_8c.html#ca94cde3142ff1121bb0ff9bd44fa762">dwc_otg_hcd_complete_xfer_ddma</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__hc.html">dwc_hc_t</a> *hc, <a class="el" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs, dwc_otg_halt_status_e halt_status)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function is called from interrupt handlers.  <a href="#ca94cde3142ff1121bb0ff9bd44fa762"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This file contains Descriptor DMA support implementation for host mode. 
<p>

<p>
Definition in file <a class="el" href="dwc__otg__hcd__ddma_8c-source.html">dwc_otg_hcd_ddma.c</a>.<hr><h2>Function Documentation</h2>
<a class="anchor" name="1c5498d173c5461865a5042789927ed1"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::dwc_otg_hcd_qh_init_ddma" ref="1c5498d173c5461865a5042789927ed1" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dwc_otg_hcd_qh_init_ddma           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initializes a QH structure's Descriptor DMA related members. 
<p>
Allocates memory for descriptor list. On first periodic QH, allocates memory for FrameList and enables periodic scheduling.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>The QH to init.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__ddma_8c-source.html#l00294">294</a> of file <a class="el" href="dwc__otg__hcd__ddma_8c-source.html">dwc_otg_hcd_ddma.c</a>.
</div>
</div><p>
<a class="anchor" name="78738afd0ca62e394753f1cf196476c9"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::dwc_otg_hcd_qh_free_ddma" ref="78738afd0ca62e394753f1cf196476c9" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dwc_otg_hcd_qh_free_ddma           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Frees descriptor list memory associated with the QH. 
<p>
If QH is periodic and the last, frees FrameList memory and disables periodic scheduling.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>The QH to init. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__ddma_8c-source.html#l00327">327</a> of file <a class="el" href="dwc__otg__hcd__ddma_8c-source.html">dwc_otg_hcd_ddma.c</a>.
</div>
</div><p>
<a class="anchor" name="9b051bad5e81a6b6d74b817c741bfaf3"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::dwc_otg_hcd_start_xfer_ddma" ref="9b051bad5e81a6b6d74b817c741bfaf3" args="(dwc_otg_hcd_t *hcd, dwc_otg_qh_t *qh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dwc_otg_hcd_start_xfer_ddma           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="paramname"> <em>qh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
For Control and Bulk endpoints initializes descriptor list and starts the transfer. 
<p>
For Interrupt and Isochronous endpoints initializes descriptor list then updates FrameList, marking appropriate entries as active. In case of Isochronous, the starting descriptor index is calculated based on the scheduled frame, but only on the first transfer descriptor within a session. Then starts the transfer via enabling the channel. For Isochronous endpoint the channel is not halted on XferComplete interrupt so remains assigned to the endpoint(QH) until session is done.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>The QH to init.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__ddma_8c-source.html#l00675">675</a> of file <a class="el" href="dwc__otg__hcd__ddma_8c-source.html">dwc_otg_hcd_ddma.c</a>.
</div>
</div><p>
<a class="anchor" name="ca94cde3142ff1121bb0ff9bd44fa762"></a><!-- doxytag: member="dwc_otg_hcd_ddma.c::dwc_otg_hcd_complete_xfer_ddma" ref="ca94cde3142ff1121bb0ff9bd44fa762" args="(dwc_otg_hcd_t *hcd, dwc_hc_t *hc, dwc_otg_hc_regs_t *hc_regs, dwc_otg_halt_status_e halt_status)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dwc_otg_hcd_complete_xfer_ddma           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__hc.html">dwc_hc_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *&nbsp;</td>
          <td class="paramname"> <em>hc_regs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">dwc_otg_halt_status_e&nbsp;</td>
          <td class="paramname"> <em>halt_status</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function is called from interrupt handlers. 
<p>
Scans the descriptor list, updates URB's status and calls completion routine for the URB if it's done. Releases the channel to be used by other transfers. In case of Isochronous endpoint the channel is not halted until the end of the session, i.e. QTD list is empty. If periodic channel released the FrameList is updated accordingly.<p>
Calls transaction selection routines to activate pending transfers.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hc</em>&nbsp;</td><td>Host channel, the transfer is completed on. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hc_regs</em>&nbsp;</td><td>Host channel registers. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>halt_status</em>&nbsp;</td><td>Reason the channel is being halted, or just XferComplete for isochronous transfer </td></tr>
  </table>
</dl>

<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000015">Todo:</a></b></dt><dd>Consider the case when period exceeds FrameList size. Frame Rollover interrupt should be used. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__ddma_8c-source.html#l01042">1042</a> of file <a class="el" href="dwc__otg__hcd__ddma_8c-source.html">dwc_otg_hcd_ddma.c</a>.
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Tue May 5 02:22:49 2009 for DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
